import { storagesStore } from './storage.js';
import { serializeStorage } from './utils3.js';
import { configurableValue } from './shared-types.js';
import { userData } from './user-data.js';
import './dayjs.min.js';
function getShipStorages() {
  const allStorages = storagesStore.all.value ?? [];
  return allStorages.filter(x => x.type === 'SHIP_STORE' && x.name !== null && x.name !== void 0);
}
function serializeShipStorage(storage) {
  return `${storage.name} (${storage.addressableId})`;
}
function createQuickPurchasePackage(name, materials, exchange, shipStorage, includePriceFetch) {
  const roundedMaterials = {};
  for (const [ticker, amount] of Object.entries(materials)) {
    roundedMaterials[ticker] = Math.ceil(amount);
  }
  const materialGroup = {
    type: 'Manual',
    name: 'Materials',
    materials: roundedMaterials,
  };
  const buyAction = {
    type: 'CX Buy',
    name: 'Buy Materials',
    group: 'Materials',
    exchange,
    useCXInv: true,
    buyPartial: false,
    allowUnfilled: false,
  };
  const actions = [];
  if (includePriceFetch) {
    const fetchAction = {
      type: 'CX Fetch',
      name: 'Load Prices',
      exchange,
      tickers: Object.keys(roundedMaterials),
    };
    actions.push(fetchAction);
  }
  actions.push(buyAction);
  if (shipStorage) {
    const transferAction = {
      type: 'MTRA',
      name: 'Transfer to Ship',
      group: 'Materials',
      origin: configurableValue,
      dest: serializeStorage(shipStorage),
    };
    actions.push(transferAction);
  }
  return {
    global: {
      name,
    },
    groups: [materialGroup],
    actions,
  };
}
function createPriceFetchPackage(name, materials, exchange) {
  const fetchAction = {
    type: 'CX Fetch',
    name: 'Fetch Prices',
    exchange,
    tickers: materials,
  };
  return {
    global: {
      name,
    },
    groups: [],
    actions: [fetchAction],
  };
}
function addAndNavigateToPackage(pkg) {
  userData.actionPackages.push(pkg);
  return pkg.global.name;
}
export {
  addAndNavigateToPackage,
  createPriceFetchPackage,
  createQuickPurchasePackage,
  getShipStorages,
  serializeShipStorage,
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVpY2stcHVyY2hhc2UtdXRpbHMuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9mZWF0dXJlcy9YSVQvc2hhcmVkL3F1aWNrLXB1cmNoYXNlLXV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHN0b3JhZ2VzU3RvcmUgfSBmcm9tICdAc3JjL2luZnJhc3RydWN0dXJlL3BydW4tYXBpL2RhdGEvc3RvcmFnZSc7XG5pbXBvcnQgeyB3YXJlaG91c2VzU3RvcmUgfSBmcm9tICdAc3JjL2luZnJhc3RydWN0dXJlL3BydW4tYXBpL2RhdGEvd2FyZWhvdXNlcyc7XG5pbXBvcnQgeyBzZXJpYWxpemVTdG9yYWdlIH0gZnJvbSAnQHNyYy9mZWF0dXJlcy9YSVQvQUNUL2FjdGlvbnMvdXRpbHMnO1xuaW1wb3J0IHsgY29uZmlndXJhYmxlVmFsdWUgfSBmcm9tICdAc3JjL2ZlYXR1cmVzL1hJVC9BQ1Qvc2hhcmVkLXR5cGVzJztcbmltcG9ydCB7IHVzZXJEYXRhIH0gZnJvbSAnQHNyYy9zdG9yZS91c2VyLWRhdGEnO1xuaW1wb3J0IGRheWpzIGZyb20gJ2RheWpzJztcblxuLyoqXG4gKiBHZXQgYWxsIHNoaXAgc3RvcmFnZXMgYXZhaWxhYmxlIGZvciBtYXRlcmlhbCB0cmFuc2ZlclxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2hpcFN0b3JhZ2VzKCkge1xuICBjb25zdCBhbGxTdG9yYWdlcyA9IHN0b3JhZ2VzU3RvcmUuYWxsLnZhbHVlID8/IFtdO1xuICByZXR1cm4gYWxsU3RvcmFnZXMuZmlsdGVyKFxuICAgIHggPT4geC50eXBlID09PSAnU0hJUF9TVE9SRScgJiYgeC5uYW1lICE9PSBudWxsICYmIHgubmFtZSAhPT0gdW5kZWZpbmVkLFxuICApO1xufVxuXG4vKipcbiAqIFNlcmlhbGl6ZSBzdG9yYWdlIGZvciBkaXNwbGF5IGluIGRyb3Bkb3duXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXJpYWxpemVTaGlwU3RvcmFnZShzdG9yYWdlOiBQcnVuQXBpLlN0b3JlKTogc3RyaW5nIHtcbiAgcmV0dXJuIGAke3N0b3JhZ2UubmFtZX0gKCR7c3RvcmFnZS5hZGRyZXNzYWJsZUlkfSlgO1xufVxuXG4vKipcbiAqIENyZWF0ZSBhIHVuaXF1ZSBhY3Rpb24gcGFja2FnZSBuYW1lIHdpdGggdGltZXN0YW1wXG4gKiBQYWNrYWdlIG5hbWVzIHVzZSB1bmRlcnNjb3JlcyBpbnN0ZWFkIG9mIHNwYWNlcyB0byBhdm9pZCBjb21tYW5kIHBhcnNpbmcgaXNzdWVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVBhY2thZ2VOYW1lKHByZWZpeDogc3RyaW5nKTogc3RyaW5nIHtcbiAgY29uc3QgdGltZXN0YW1wID0gZGF5anMoKS5mb3JtYXQoJ1lZWVktTU0tREQgSEhtbScpO1xuICByZXR1cm4gYCR7cHJlZml4fSAke3RpbWVzdGFtcH1gO1xufVxuXG4vKipcbiAqIENyZWF0ZSBhIHF1aWNrIHB1cmNoYXNlIGFjdGlvbiBwYWNrYWdlXG4gKiBAcGFyYW0gbmFtZSAtIFBhY2thZ2UgbmFtZVxuICogQHBhcmFtIG1hdGVyaWFscyAtIFJlY29yZCBvZiBtYXRlcmlhbCB0aWNrZXIgdG8gYW1vdW50IG5lZWRlZFxuICogQHBhcmFtIGV4Y2hhbmdlIC0gRXhjaGFuZ2UgY29kZSAoZS5nLiwgJ0lDMScpXG4gKiBAcGFyYW0gc2hpcFN0b3JhZ2UgLSBUYXJnZXQgc2hpcCBzdG9yYWdlIG9iamVjdCAob3B0aW9uYWwpXG4gKiBAcmV0dXJucyBBY3Rpb25QYWNrYWdlRGF0YSByZWFkeSB0byBiZSBhZGRlZCB0byB1c2VyRGF0YVxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUXVpY2tQdXJjaGFzZVBhY2thZ2UoXG4gIG5hbWU6IHN0cmluZyxcbiAgbWF0ZXJpYWxzOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+LFxuICBleGNoYW5nZTogc3RyaW5nLFxuICBzaGlwU3RvcmFnZT86IFBydW5BcGkuU3RvcmUsXG4gIGluY2x1ZGVQcmljZUZldGNoPzogYm9vbGVhbixcbik6IFVzZXJEYXRhLkFjdGlvblBhY2thZ2VEYXRhIHtcbiAgLy8gUm91bmQgdXAgYWxsIG1hdGVyaWFsIHF1YW50aXRpZXMgdG8gaW50ZWdlcnMgKHlvdSBjYW4ndCBidXkgZnJhY3Rpb25hbCBhbW91bnRzKVxuICBjb25zdCByb3VuZGVkTWF0ZXJpYWxzOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge307XG4gIGZvciAoY29uc3QgW3RpY2tlciwgYW1vdW50XSBvZiBPYmplY3QuZW50cmllcyhtYXRlcmlhbHMpKSB7XG4gICAgcm91bmRlZE1hdGVyaWFsc1t0aWNrZXJdID0gTWF0aC5jZWlsKGFtb3VudCk7XG4gIH1cblxuICAvLyBDcmVhdGUgbWF0ZXJpYWwgZ3JvdXBcbiAgY29uc3QgbWF0ZXJpYWxHcm91cDogVXNlckRhdGEuTWF0ZXJpYWxHcm91cERhdGEgPSB7XG4gICAgdHlwZTogJ01hbnVhbCcsXG4gICAgbmFtZTogJ01hdGVyaWFscycsXG4gICAgbWF0ZXJpYWxzOiByb3VuZGVkTWF0ZXJpYWxzLFxuICB9O1xuXG4gIC8vIENyZWF0ZSBDWCBCdXkgYWN0aW9uXG4gIGNvbnN0IGJ1eUFjdGlvbjogVXNlckRhdGEuQWN0aW9uRGF0YSA9IHtcbiAgICB0eXBlOiAnQ1ggQnV5JyxcbiAgICBuYW1lOiAnQnV5IE1hdGVyaWFscycsXG4gICAgZ3JvdXA6ICdNYXRlcmlhbHMnLFxuICAgIGV4Y2hhbmdlLFxuICAgIHVzZUNYSW52OiB0cnVlLFxuICAgIGJ1eVBhcnRpYWw6IGZhbHNlLFxuICAgIGFsbG93VW5maWxsZWQ6IGZhbHNlLFxuICB9O1xuXG4gIGNvbnN0IGFjdGlvbnM6IFVzZXJEYXRhLkFjdGlvbkRhdGFbXSA9IFtdO1xuXG4gIC8vIElmIHJlcXVlc3RlZCwgYWRkIHByaWNlIGZldGNoIHN0ZXAgZmlyc3RcbiAgaWYgKGluY2x1ZGVQcmljZUZldGNoKSB7XG4gICAgY29uc3QgZmV0Y2hBY3Rpb246IFVzZXJEYXRhLkFjdGlvbkRhdGEgPSB7XG4gICAgICB0eXBlOiAnQ1ggRmV0Y2gnLFxuICAgICAgbmFtZTogJ0xvYWQgUHJpY2VzJyxcbiAgICAgIGV4Y2hhbmdlLFxuICAgICAgdGlja2VyczogT2JqZWN0LmtleXMocm91bmRlZE1hdGVyaWFscyksXG4gICAgfTtcbiAgICBhY3Rpb25zLnB1c2goZmV0Y2hBY3Rpb24pO1xuICB9XG5cbiAgLy8gQWRkIGJ1eSBhY3Rpb25cbiAgYWN0aW9ucy5wdXNoKGJ1eUFjdGlvbik7XG5cbiAgLy8gT25seSBjcmVhdGUgdHJhbnNmZXIgYWN0aW9uIGlmIGEgdmFsaWQgc2hpcCBzdG9yYWdlIGlzIHByb3ZpZGVkXG4gIGlmIChzaGlwU3RvcmFnZSkge1xuICAgIC8vIFVzZSBjb25maWd1cmFibGVWYWx1ZSBmb3Igb3JpZ2luIC0gbGV0IHVzZXIgc2VsZWN0IHdhcmVob3VzZSBhdCBleGVjdXRpb24gdGltZVxuICAgIC8vIFRoaXMgaXMgc2FmZXIgYmVjYXVzZSB3YXJlaG91c2UgZGF0YSBtYXkgbm90IGJlIGxvYWRlZCBhdCBwYWNrYWdlIGNyZWF0aW9uIHRpbWVcbiAgICBjb25zdCB0cmFuc2ZlckFjdGlvbjogVXNlckRhdGEuQWN0aW9uRGF0YSA9IHtcbiAgICAgIHR5cGU6ICdNVFJBJyxcbiAgICAgIG5hbWU6ICdUcmFuc2ZlciB0byBTaGlwJyxcbiAgICAgIGdyb3VwOiAnTWF0ZXJpYWxzJyxcbiAgICAgIG9yaWdpbjogY29uZmlndXJhYmxlVmFsdWUsXG4gICAgICBkZXN0OiBzZXJpYWxpemVTdG9yYWdlKHNoaXBTdG9yYWdlKSxcbiAgICB9O1xuICAgIGFjdGlvbnMucHVzaCh0cmFuc2ZlckFjdGlvbik7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGdsb2JhbDoge1xuICAgICAgbmFtZSxcbiAgICB9LFxuICAgIGdyb3VwczogW21hdGVyaWFsR3JvdXBdLFxuICAgIGFjdGlvbnMsXG4gIH07XG59XG5cbi8qKlxuICogQ3JlYXRlIGEgcHJpY2UgZmV0Y2ggYWN0aW9uIHBhY2thZ2VcbiAqIEBwYXJhbSBuYW1lIC0gUGFja2FnZSBuYW1lXG4gKiBAcGFyYW0gbWF0ZXJpYWxzIC0gTGlzdCBvZiB0aWNrZXJzXG4gKiBAcGFyYW0gZXhjaGFuZ2UgLSBFeGNoYW5nZSBjb2RlXG4gKiBAcmV0dXJucyBBY3Rpb25QYWNrYWdlRGF0YVxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUHJpY2VGZXRjaFBhY2thZ2UoXG4gIG5hbWU6IHN0cmluZyxcbiAgbWF0ZXJpYWxzOiBzdHJpbmdbXSxcbiAgZXhjaGFuZ2U6IHN0cmluZyxcbik6IFVzZXJEYXRhLkFjdGlvblBhY2thZ2VEYXRhIHtcbiAgY29uc3QgZmV0Y2hBY3Rpb246IFVzZXJEYXRhLkFjdGlvbkRhdGEgPSB7XG4gICAgdHlwZTogJ0NYIEZldGNoJyxcbiAgICBuYW1lOiAnRmV0Y2ggUHJpY2VzJyxcbiAgICBleGNoYW5nZSxcbiAgICB0aWNrZXJzOiBtYXRlcmlhbHMsXG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBnbG9iYWw6IHtcbiAgICAgIG5hbWUsXG4gICAgfSxcbiAgICBncm91cHM6IFtdLFxuICAgIGFjdGlvbnM6IFtmZXRjaEFjdGlvbl0sXG4gIH07XG59XG5cbi8qKlxuICogQWRkIGFjdGlvbiBwYWNrYWdlIHRvIHVzZXIgZGF0YSBhbmQgcmV0dXJuIGl0cyBuYW1lXG4gKiBAcGFyYW0gcGtnIC0gQWN0aW9uIHBhY2thZ2UgdG8gYWRkXG4gKiBAcmV0dXJucyBUaGUgcGFja2FnZSBuYW1lIGZvciBuYXZpZ2F0aW9uXG4gKiBAcmV0dXJucyBUaGUgcGFja2FnZSBuYW1lIGZvciBuYXZpZ2F0aW9uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhZGRBbmROYXZpZ2F0ZVRvUGFja2FnZShwa2c6IFVzZXJEYXRhLkFjdGlvblBhY2thZ2VEYXRhKTogc3RyaW5nIHtcbiAgdXNlckRhdGEuYWN0aW9uUGFja2FnZXMucHVzaChwa2cpO1xuICByZXR1cm4gcGtnLmdsb2JhbC5uYW1lO1xufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBVU8sU0FBUyxrQkFBa0I7QUFDaEMsUUFBTSxjQUFjLGNBQWMsSUFBSSxTQUFTLENBQUE7QUFDL0MsU0FBTyxZQUFZO0FBQUEsSUFDakIsQ0FBQSxNQUFLLEVBQUUsU0FBUyxnQkFBZ0IsRUFBRSxTQUFTLFFBQVEsRUFBRSxTQUFTO0FBQUEsRUFBQTtBQUVsRTtBQUtPLFNBQVMscUJBQXFCLFNBQWdDO0FBQ25FLFNBQU8sR0FBRyxRQUFRLElBQUksS0FBSyxRQUFRLGFBQWE7QUFDbEQ7QUFtQk8sU0FBUywyQkFDZCxNQUNBLFdBQ0EsVUFDQSxhQUNBLG1CQUM0QjtBQUU1QixRQUFNLG1CQUEyQyxDQUFBO0FBQ2pELGFBQVcsQ0FBQyxRQUFRLE1BQU0sS0FBSyxPQUFPLFFBQVEsU0FBUyxHQUFHO0FBQ3hELHFCQUFpQixNQUFNLElBQUksS0FBSyxLQUFLLE1BQU07QUFBQSxFQUM3QztBQUdBLFFBQU0sZ0JBQTRDO0FBQUEsSUFDaEQsTUFBTTtBQUFBLElBQ04sTUFBTTtBQUFBLElBQ04sV0FBVztBQUFBLEVBQUE7QUFJYixRQUFNLFlBQWlDO0FBQUEsSUFDckMsTUFBTTtBQUFBLElBQ04sTUFBTTtBQUFBLElBQ04sT0FBTztBQUFBLElBQ1A7QUFBQSxJQUNBLFVBQVU7QUFBQSxJQUNWLFlBQVk7QUFBQSxJQUNaLGVBQWU7QUFBQSxFQUFBO0FBR2pCLFFBQU0sVUFBaUMsQ0FBQTtBQUd2QyxNQUFJLG1CQUFtQjtBQUNyQixVQUFNLGNBQW1DO0FBQUEsTUFDdkMsTUFBTTtBQUFBLE1BQ04sTUFBTTtBQUFBLE1BQ047QUFBQSxNQUNBLFNBQVMsT0FBTyxLQUFLLGdCQUFnQjtBQUFBLElBQUE7QUFFdkMsWUFBUSxLQUFLLFdBQVc7QUFBQSxFQUMxQjtBQUdBLFVBQVEsS0FBSyxTQUFTO0FBR3RCLE1BQUksYUFBYTtBQUdmLFVBQU0saUJBQXNDO0FBQUEsTUFDMUMsTUFBTTtBQUFBLE1BQ04sTUFBTTtBQUFBLE1BQ04sT0FBTztBQUFBLE1BQ1AsUUFBUTtBQUFBLE1BQ1IsTUFBTSxpQkFBaUIsV0FBVztBQUFBLElBQUE7QUFFcEMsWUFBUSxLQUFLLGNBQWM7QUFBQSxFQUM3QjtBQUVBLFNBQU87QUFBQSxJQUNMLFFBQVE7QUFBQSxNQUNOO0FBQUEsSUFBQTtBQUFBLElBRUYsUUFBUSxDQUFDLGFBQWE7QUFBQSxJQUN0QjtBQUFBLEVBQUE7QUFFSjtBQVNPLFNBQVMsd0JBQ2QsTUFDQSxXQUNBLFVBQzRCO0FBQzVCLFFBQU0sY0FBbUM7QUFBQSxJQUN2QyxNQUFNO0FBQUEsSUFDTixNQUFNO0FBQUEsSUFDTjtBQUFBLElBQ0EsU0FBUztBQUFBLEVBQUE7QUFHWCxTQUFPO0FBQUEsSUFDTCxRQUFRO0FBQUEsTUFDTjtBQUFBLElBQUE7QUFBQSxJQUVGLFFBQVEsQ0FBQTtBQUFBLElBQ1IsU0FBUyxDQUFDLFdBQVc7QUFBQSxFQUFBO0FBRXpCO0FBUU8sU0FBUyx3QkFBd0IsS0FBeUM7QUFDL0UsV0FBUyxlQUFlLEtBQUssR0FBRztBQUNoQyxTQUFPLElBQUksT0FBTztBQUNwQjsifQ==
