import { createEntityStore } from './create-entity-store.js';
import { onApiMessage } from './api-messages.js';
const store = createEntityStore();
const state = store.state;
onApiMessage({
  UI_DATA(data) {
    store.setAll(data.tiles);
    store.setFetched();
    tilesStore.listener.tilesInitialized();
  },
  UI_TILES_CHANGE_COMMAND(data) {
    const tile = state.getById(data.id);
    if (!tile) {
      return;
    }
    store.setOne({
      ...tile,
      content: data.newCommand,
    });
    tilesStore.listener.tileRemoved(data.id);
  },
  UI_TILES_MOVE(data) {
    const source = state.getById(data.sourceId);
    if (!source) {
      return;
    }
    const target = state.getById(data.targetId);
    if (!target) {
      return;
    }
    store.setOne({
      ...source,
      content: null,
    });
    store.setOne({
      ...target,
      content: data.content,
    });
    tilesStore.listener.tileMoved(data.sourceId, data.targetId);
  },
  UI_TILES_SPLIT(data) {
    const tile = state.getById(data.id);
    if (!tile) {
      return;
    }
    store.setOne({
      id: data.newId1,
      parentId: data.id,
      content: tile.content,
      container: null,
    });
    store.setOne({
      id: data.newId2,
      parentId: data.id,
      content: null,
      container: null,
    });
    store.setOne({
      ...tile,
      content: null,
      container: {
        child1Id: data.newId1,
        child2Id: data.newId2,
        vertical: data.vertically,
        dividerPosition: 0.5,
      },
    });
    tilesStore.listener.tileMoved(data.id, data.newId1);
  },
  UI_TILES_REMOVE(data) {
    const tile = state.getById(data.id);
    if (!tile) {
      return;
    }
    const parent = state.getById(tile.parentId);
    const container = parent?.container;
    if (!container) {
      return;
    }
    const otherId = container.child1Id !== data.id ? container.child1Id : container.child1Id;
    const other = state.getById(otherId);
    if (!other) {
      return;
    }
    store.setOne({
      ...parent,
      container: null,
      content: other.content,
    });
    store.removeOne(tile.id);
    store.removeOne(other.id);
    tilesStore.listener.tileRemoved(tile.id);
    tilesStore.listener.tileMoved(other.id, parent.id);
  },
  UI_TILES_CHANGE_SIZE(data) {
    const tile = state.getById(data.id);
    if (!tile || !tile.container) {
      return;
    }
    store.setOne({
      ...tile,
      container: {
        ...tile.container,
        dividerPosition: data.newDividerPosition,
      },
    });
  },
});
const tilesStore = {
  ...state,
  listener: {
    tilesInitialized() {},
    tileMoved() {},
    tileRemoved() {},
  },
};
export { tilesStore };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGlsZXMyLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvaW5mcmFzdHJ1Y3R1cmUvcHJ1bi1hcGkvZGF0YS90aWxlcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVFbnRpdHlTdG9yZSB9IGZyb20gJ0BzcmMvaW5mcmFzdHJ1Y3R1cmUvcHJ1bi1hcGkvZGF0YS9jcmVhdGUtZW50aXR5LXN0b3JlJztcbmltcG9ydCB7IG9uQXBpTWVzc2FnZSB9IGZyb20gJ0BzcmMvaW5mcmFzdHJ1Y3R1cmUvcHJ1bi1hcGkvZGF0YS9hcGktbWVzc2FnZXMnO1xuXG5jb25zdCBzdG9yZSA9IGNyZWF0ZUVudGl0eVN0b3JlPFBydW5BcGkuVGlsZT4oKTtcbmNvbnN0IHN0YXRlID0gc3RvcmUuc3RhdGU7XG5cbm9uQXBpTWVzc2FnZSh7XG4gIFVJX0RBVEEoZGF0YTogUHJ1bkFwaS5VSURhdGEpIHtcbiAgICBzdG9yZS5zZXRBbGwoZGF0YS50aWxlcyk7XG4gICAgc3RvcmUuc2V0RmV0Y2hlZCgpO1xuICAgIHRpbGVzU3RvcmUubGlzdGVuZXIudGlsZXNJbml0aWFsaXplZCgpO1xuICB9LFxuICBVSV9USUxFU19DSEFOR0VfQ09NTUFORChkYXRhOiB7IGlkOiBzdHJpbmc7IG5ld0NvbW1hbmQ6IHN0cmluZyB8IG51bGwgfSkge1xuICAgIGNvbnN0IHRpbGUgPSBzdGF0ZS5nZXRCeUlkKGRhdGEuaWQpO1xuICAgIGlmICghdGlsZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHN0b3JlLnNldE9uZSh7XG4gICAgICAuLi50aWxlLFxuICAgICAgY29udGVudDogZGF0YS5uZXdDb21tYW5kLFxuICAgIH0pO1xuICAgIHRpbGVzU3RvcmUubGlzdGVuZXIudGlsZVJlbW92ZWQoZGF0YS5pZCk7XG4gIH0sXG4gIFVJX1RJTEVTX01PVkUoZGF0YTogeyBzb3VyY2VJZDogc3RyaW5nOyB0YXJnZXRJZDogc3RyaW5nOyBjb250ZW50OiBzdHJpbmcgfSkge1xuICAgIGNvbnN0IHNvdXJjZSA9IHN0YXRlLmdldEJ5SWQoZGF0YS5zb3VyY2VJZCk7XG4gICAgaWYgKCFzb3VyY2UpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB0YXJnZXQgPSBzdGF0ZS5nZXRCeUlkKGRhdGEudGFyZ2V0SWQpO1xuICAgIGlmICghdGFyZ2V0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgc3RvcmUuc2V0T25lKHtcbiAgICAgIC4uLnNvdXJjZSxcbiAgICAgIGNvbnRlbnQ6IG51bGwsXG4gICAgfSk7XG4gICAgc3RvcmUuc2V0T25lKHtcbiAgICAgIC4uLnRhcmdldCxcbiAgICAgIGNvbnRlbnQ6IGRhdGEuY29udGVudCxcbiAgICB9KTtcbiAgICB0aWxlc1N0b3JlLmxpc3RlbmVyLnRpbGVNb3ZlZChkYXRhLnNvdXJjZUlkLCBkYXRhLnRhcmdldElkKTtcbiAgfSxcbiAgVUlfVElMRVNfU1BMSVQoZGF0YTogeyBpZDogc3RyaW5nOyBuZXdJZDE6IHN0cmluZzsgbmV3SWQyOiBzdHJpbmc7IHZlcnRpY2FsbHk6IGJvb2xlYW4gfSkge1xuICAgIGNvbnN0IHRpbGUgPSBzdGF0ZS5nZXRCeUlkKGRhdGEuaWQpO1xuICAgIGlmICghdGlsZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHN0b3JlLnNldE9uZSh7XG4gICAgICBpZDogZGF0YS5uZXdJZDEsXG4gICAgICBwYXJlbnRJZDogZGF0YS5pZCxcbiAgICAgIGNvbnRlbnQ6IHRpbGUuY29udGVudCxcbiAgICAgIGNvbnRhaW5lcjogbnVsbCxcbiAgICB9KTtcblxuICAgIHN0b3JlLnNldE9uZSh7XG4gICAgICBpZDogZGF0YS5uZXdJZDIsXG4gICAgICBwYXJlbnRJZDogZGF0YS5pZCxcbiAgICAgIGNvbnRlbnQ6IG51bGwsXG4gICAgICBjb250YWluZXI6IG51bGwsXG4gICAgfSk7XG5cbiAgICBzdG9yZS5zZXRPbmUoe1xuICAgICAgLi4udGlsZSxcbiAgICAgIGNvbnRlbnQ6IG51bGwsXG4gICAgICBjb250YWluZXI6IHtcbiAgICAgICAgY2hpbGQxSWQ6IGRhdGEubmV3SWQxLFxuICAgICAgICBjaGlsZDJJZDogZGF0YS5uZXdJZDIsXG4gICAgICAgIHZlcnRpY2FsOiBkYXRhLnZlcnRpY2FsbHksXG4gICAgICAgIGRpdmlkZXJQb3NpdGlvbjogMC41LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHRpbGVzU3RvcmUubGlzdGVuZXIudGlsZU1vdmVkKGRhdGEuaWQsIGRhdGEubmV3SWQxKTtcbiAgfSxcbiAgVUlfVElMRVNfUkVNT1ZFKGRhdGE6IHsgaWQ6IHN0cmluZyB9KSB7XG4gICAgY29uc3QgdGlsZSA9IHN0YXRlLmdldEJ5SWQoZGF0YS5pZCk7XG4gICAgaWYgKCF0aWxlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcGFyZW50ID0gc3RhdGUuZ2V0QnlJZCh0aWxlLnBhcmVudElkKTtcbiAgICBjb25zdCBjb250YWluZXIgPSBwYXJlbnQ/LmNvbnRhaW5lcjtcbiAgICBpZiAoIWNvbnRhaW5lcikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IG90aGVySWQgPSBjb250YWluZXIuY2hpbGQxSWQgIT09IGRhdGEuaWQgPyBjb250YWluZXIuY2hpbGQxSWQgOiBjb250YWluZXIuY2hpbGQxSWQ7XG4gICAgY29uc3Qgb3RoZXIgPSBzdGF0ZS5nZXRCeUlkKG90aGVySWQpO1xuICAgIGlmICghb3RoZXIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzdG9yZS5zZXRPbmUoe1xuICAgICAgLi4ucGFyZW50LFxuICAgICAgY29udGFpbmVyOiBudWxsLFxuICAgICAgY29udGVudDogb3RoZXIuY29udGVudCxcbiAgICB9KTtcbiAgICBzdG9yZS5yZW1vdmVPbmUodGlsZS5pZCk7XG4gICAgc3RvcmUucmVtb3ZlT25lKG90aGVyLmlkKTtcblxuICAgIHRpbGVzU3RvcmUubGlzdGVuZXIudGlsZVJlbW92ZWQodGlsZS5pZCk7XG4gICAgdGlsZXNTdG9yZS5saXN0ZW5lci50aWxlTW92ZWQob3RoZXIuaWQsIHBhcmVudC5pZCk7XG4gIH0sXG4gIFVJX1RJTEVTX0NIQU5HRV9TSVpFKGRhdGE6IHsgaWQ6IHN0cmluZzsgbmV3RGl2aWRlclBvc2l0aW9uOiBudW1iZXIgfSkge1xuICAgIGNvbnN0IHRpbGUgPSBzdGF0ZS5nZXRCeUlkKGRhdGEuaWQpO1xuICAgIGlmICghdGlsZSB8fCAhdGlsZS5jb250YWluZXIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzdG9yZS5zZXRPbmUoe1xuICAgICAgLi4udGlsZSxcbiAgICAgIGNvbnRhaW5lcjoge1xuICAgICAgICAuLi50aWxlLmNvbnRhaW5lcixcbiAgICAgICAgZGl2aWRlclBvc2l0aW9uOiBkYXRhLm5ld0RpdmlkZXJQb3NpdGlvbixcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0sXG59KTtcblxuaW50ZXJmYWNlIENoYW5nZUxpc3RlbmVyIHtcbiAgdGlsZXNJbml0aWFsaXplZCgpOiB2b2lkO1xuXG4gIHRpbGVNb3ZlZChmcm9tSWQ6IHN0cmluZywgdG9JZDogc3RyaW5nKTogdm9pZDtcblxuICB0aWxlUmVtb3ZlZChpZDogc3RyaW5nKTogdm9pZDtcbn1cblxuZXhwb3J0IGNvbnN0IHRpbGVzU3RvcmUgPSB7XG4gIC4uLnN0YXRlLFxuICBsaXN0ZW5lcjoge1xuICAgIHRpbGVzSW5pdGlhbGl6ZWQoKSB7fSxcbiAgICB0aWxlTW92ZWQoKSB7fSxcbiAgICB0aWxlUmVtb3ZlZCgpIHt9LFxuICB9IGFzIENoYW5nZUxpc3RlbmVyLFxufTtcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUdBLE1BQU0sUUFBUSxrQkFBQTtBQUNkLE1BQU0sUUFBUSxNQUFNO0FBRXBCLGFBQWE7QUFBQSxFQUNYLFFBQVEsTUFBc0I7QUFDNUIsVUFBTSxPQUFPLEtBQUssS0FBSztBQUN2QixVQUFNLFdBQUE7QUFDTixlQUFXLFNBQVMsaUJBQUE7QUFBQSxFQUN0QjtBQUFB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
