import { sitesStore } from './sites.js';
import {
  getEntityNameFromAddress,
  isSameAddress,
  getLocationLineFromAddress,
} from './addresses.js';
import { warehousesStore } from './warehouses.js';
import { storagesStore } from './storage.js';
import { shipsStore } from './ships.js';
function serializeStorage(storage) {
  switch (storage.type) {
    case 'STL_FUEL_STORE':
      return storage.name + ' STL Store';
    case 'FTL_FUEL_STORE':
      return storage.name + ' FTL Store';
    case 'SHIP_STORE':
      return storage.name + ' Cargo';
    case 'STORE': {
      const site = sitesStore.getById(storage.addressableId);
      return getEntityNameFromAddress(site?.address) + ' Base';
    }
    case 'WAREHOUSE_STORE': {
      const warehouse = warehousesStore.getById(storage.addressableId);
      return getEntityNameFromAddress(warehouse?.address) + ' Warehouse';
    }
  }
  return 'Error, unable to serialize';
}
function deserializeStorage(serializedName) {
  if (!serializedName) {
    return void 0;
  }
  let name;
  name = extractName(serializedName, 'Base');
  if (name) {
    const site = sitesStore.getByPlanetNaturalIdOrName(name);
    return storagesStore.getByAddressableId(site?.siteId)?.find(x => x.type === 'STORE');
  }
  name = extractName(serializedName, 'Warehouse');
  if (name) {
    const warehouse = warehousesStore.getByEntityNaturalIdOrName(name);
    return storagesStore
      .getByAddressableId(warehouse?.warehouseId)
      ?.find(x => x.type === 'WAREHOUSE_STORE');
  }
  name = extractName(serializedName, 'Cargo');
  if (name) {
    return storagesStore.getByName(name)?.find(x => x.type === 'SHIP_STORE');
  }
  name = extractName(serializedName, 'FTL Store');
  if (name) {
    return storagesStore.getByName(name)?.find(x => x.type === 'FTL_FUEL_STORE');
  }
  name = extractName(serializedName, 'STL Store');
  if (name) {
    return storagesStore.getByName(name)?.find(x => x.type === 'STL_FUEL_STORE');
  }
  return void 0;
}
function extractName(name, suffix) {
  return name.endsWith(suffix) ? name.replace(' ' + suffix, '') : void 0;
}
function storageSort(a, b) {
  const storagePriorityMap = {
    FTL_FUEL_STORE: 5,
    STL_FUEL_STORE: 4,
    SHIP_STORE: 3,
    STORE: 1,
    WAREHOUSE_STORE: 2,
  };
  const priorityA = isCXWarehouse(a) ? 0 : (storagePriorityMap[a.type] ?? 6);
  const priorityB = isCXWarehouse(b) ? 0 : (storagePriorityMap[b.type] ?? 6);
  if (priorityA !== priorityB) {
    return priorityA - priorityB;
  }
  return serializeStorage(a).localeCompare(serializeStorage(b));
}
function isCXWarehouse(storage) {
  if (storage.type !== 'WAREHOUSE_STORE') {
    return false;
  }
  const warehouse = warehousesStore.getById(storage.addressableId);
  const location = getLocationLineFromAddress(warehouse?.address);
  return location?.type === 'STATION';
}
function atSameLocation(storageA, storageB) {
  if (storageA === storageB) {
    return false;
  }
  const addressA = getStoreAddress(storageA);
  const addressB = getStoreAddress(storageB);
  return isSameAddress(addressA, addressB);
}
function getStoreAddress(store) {
  switch (store.type) {
    case 'STORE': {
      const site = sitesStore.getById(store.addressableId);
      return site?.address;
    }
    case 'WAREHOUSE_STORE': {
      const warehouse = warehousesStore.getById(store.addressableId);
      return warehouse?.address;
    }
    case 'SHIP_STORE':
    case 'STL_FUEL_STORE':
    case 'FTL_FUEL_STORE': {
      const ship = shipsStore.getById(store.addressableId);
      return ship?.address;
    }
    default:
      return void 0;
  }
}
export { atSameLocation, deserializeStorage, isCXWarehouse, serializeStorage, storageSort };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMzLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZmVhdHVyZXMvWElUL0FDVC9hY3Rpb25zL3V0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFBhcnNlIHN0b3JhZ2UgcGF5bG9hZCBpbnRvIGludmVudG9yeSBuYW1lIChub3QgTVRSQSBpbnZlbnRvcnkgbmFtZSlcbmltcG9ydCB7IHNpdGVzU3RvcmUgfSBmcm9tICdAc3JjL2luZnJhc3RydWN0dXJlL3BydW4tYXBpL2RhdGEvc2l0ZXMnO1xuaW1wb3J0IHtcbiAgZ2V0RW50aXR5TmFtZUZyb21BZGRyZXNzLFxuICBnZXRMb2NhdGlvbkxpbmVGcm9tQWRkcmVzcyxcbiAgaXNTYW1lQWRkcmVzcyxcbn0gZnJvbSAnQHNyYy9pbmZyYXN0cnVjdHVyZS9wcnVuLWFwaS9kYXRhL2FkZHJlc3Nlcyc7XG5pbXBvcnQgeyB3YXJlaG91c2VzU3RvcmUgfSBmcm9tICdAc3JjL2luZnJhc3RydWN0dXJlL3BydW4tYXBpL2RhdGEvd2FyZWhvdXNlcyc7XG5pbXBvcnQgeyBzdG9yYWdlc1N0b3JlIH0gZnJvbSAnQHNyYy9pbmZyYXN0cnVjdHVyZS9wcnVuLWFwaS9kYXRhL3N0b3JhZ2UnO1xuaW1wb3J0IHsgc2hpcHNTdG9yZSB9IGZyb20gJ0BzcmMvaW5mcmFzdHJ1Y3R1cmUvcHJ1bi1hcGkvZGF0YS9zaGlwcyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXJpYWxpemVTdG9yYWdlKHN0b3JhZ2U6IFBydW5BcGkuU3RvcmUpIHtcbiAgc3dpdGNoIChzdG9yYWdlLnR5cGUpIHtcbiAgICBjYXNlICdTVExfRlVFTF9TVE9SRSc6XG4gICAgICByZXR1cm4gc3RvcmFnZS5uYW1lICsgJyBTVEwgU3RvcmUnO1xuICAgIGNhc2UgJ0ZUTF9GVUVMX1NUT1JFJzpcbiAgICAgIHJldHVybiBzdG9yYWdlLm5hbWUgKyAnIEZUTCBTdG9yZSc7XG4gICAgY2FzZSAnU0hJUF9TVE9SRSc6XG4gICAgICByZXR1cm4gc3RvcmFnZS5uYW1lICsgJyBDYXJnbyc7XG4gICAgY2FzZSAnU1RPUkUnOiB7XG4gICAgICBjb25zdCBzaXRlID0gc2l0ZXNTdG9yZS5nZXRCeUlkKHN0b3JhZ2UuYWRkcmVzc2FibGVJZCk7XG4gICAgICByZXR1cm4gZ2V0RW50aXR5TmFtZUZyb21BZGRyZXNzKHNpdGU/LmFkZHJlc3MpICsgJyBCYXNlJztcbiAgICB9XG4gICAgY2FzZSAnV0FSRUhPVVNFX1NUT1JFJzoge1xuICAgICAgY29uc3Qgd2FyZWhvdXNlID0gd2FyZWhvdXNlc1N0b3JlLmdldEJ5SWQoc3RvcmFnZS5hZGRyZXNzYWJsZUlkKTtcbiAgICAgIHJldHVybiBnZXRFbnRpdHlOYW1lRnJvbUFkZHJlc3Mod2FyZWhvdXNlPy5hZGRyZXNzKSArICcgV2FyZWhvdXNlJztcbiAgICB9XG4gIH1cblxuICByZXR1cm4gJ0Vycm9yLCB1bmFibGUgdG8gc2VyaWFsaXplJztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlc2VyaWFsaXplU3RvcmFnZShzZXJpYWxpemVkTmFtZTogc3RyaW5nIHwgdW5kZWZpbmVkKSB7XG4gIGlmICghc2VyaWFsaXplZE5hbWUpIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG4gIGxldCBuYW1lOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIG5hbWUgPSBleHRyYWN0TmFtZShzZXJpYWxpemVkTmFtZSwgJ0Jhc2UnKTtcbiAgaWYgKG5hbWUpIHtcbiAgICBjb25zdCBzaXRlID0gc2l0ZXNTdG9yZS5nZXRCeVBsYW5ldE5hdHVyYWxJZE9yTmFtZShuYW1lKTtcbiAgICByZXR1cm4gc3RvcmFnZXNTdG9yZS5nZXRCeUFkZHJlc3NhYmxlSWQoc2l0ZT8uc2l0ZUlkKT8uZmluZCh4ID0+IHgudHlwZSA9PT0gJ1NUT1JFJyk7XG4gIH1cbiAgbmFtZSA9IGV4dHJhY3ROYW1lKHNlcmlhbGl6ZWROYW1lLCAnV2FyZWhvdXNlJyk7XG4gIGlmIChuYW1lKSB7XG4gICAgY29uc3Qgd2FyZWhvdXNlID0gd2FyZWhvdXNlc1N0b3JlLmdldEJ5RW50aXR5TmF0dXJhbElkT3JOYW1lKG5hbWUpO1xuICAgIHJldHVybiBzdG9yYWdlc1N0b3JlXG4gICAgICAuZ2V0QnlBZGRyZXNzYWJsZUlkKHdhcmVob3VzZT8ud2FyZWhvdXNlSWQpXG4gICAgICA/LmZpbmQoeCA9PiB4LnR5cGUgPT09ICdXQVJFSE9VU0VfU1RPUkUnKTtcbiAgfVxuICBuYW1lID0gZXh0cmFjdE5hbWUoc2VyaWFsaXplZE5hbWUsICdDYXJnbycpO1xuICBpZiAobmFtZSkge1xuICAgIHJldHVybiBzdG9yYWdlc1N0b3JlLmdldEJ5TmFtZShuYW1lKT8uZmluZCh4ID0+IHgudHlwZSA9PT0gJ1NISVBfU1RPUkUnKTtcbiAgfVxuICBuYW1lID0gZXh0cmFjdE5hbWUoc2VyaWFsaXplZE5hbWUsICdGVEwgU3RvcmUnKTtcbiAgaWYgKG5hbWUpIHtcbiAgICByZXR1cm4gc3RvcmFnZXNTdG9yZS5nZXRCeU5hbWUobmFtZSk/LmZpbmQoeCA9PiB4LnR5cGUgPT09ICdGVExfRlVFTF9TVE9SRScpO1xuICB9XG4gIG5hbWUgPSBleHRyYWN0TmFtZShzZXJpYWxpemVkTmFtZSwgJ1NUTCBTdG9yZScpO1xuICBpZiAobmFtZSkge1xuICAgIHJldHVybiBzdG9yYWdlc1N0b3JlLmdldEJ5TmFtZShuYW1lKT8uZmluZCh4ID0+IHgudHlwZSA9PT0gJ1NUTF9GVUVMX1NUT1JFJyk7XG4gIH1cblxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuXG5mdW5jdGlvbiBleHRyYWN0TmFtZShuYW1lOiBzdHJpbmcsIHN1ZmZpeDogc3RyaW5nKSB7XG4gIHJldHVybiBuYW1lLmVuZHNXaXRoKHN1ZmZpeCkgPyBuYW1lLnJlcGxhY2UoJyAnICsgc3VmZml4LCAnJykgOiB1bmRlZmluZWQ7XG59XG5cbi8vIFNvcnQgc3RvcmFnZXMgaW50byBhbiBvcmRlciBiYXNlZCBvbiB0eXBlXG5leHBvcnQgZnVuY3Rpb24gc3RvcmFnZVNvcnQoYTogUHJ1bkFwaS5TdG9yZSwgYjogUHJ1bkFwaS5TdG9yZSkge1xuICBjb25zdCBzdG9yYWdlUHJpb3JpdHlNYXAgPSB7XG4gICAgRlRMX0ZVRUxfU1RPUkU6IDUsXG4gICAgU1RMX0ZVRUxfU1RPUkU6IDQsXG4gICAgU0hJUF9TVE9SRTogMyxcbiAgICBTVE9SRTogMSxcbiAgICBXQVJFSE9VU0VfU1RPUkU6IDIsXG4gIH07XG4gIGNvbnN0IHByaW9yaXR5QSA9IGlzQ1hXYXJlaG91c2UoYSkgPyAwIDogKHN0b3JhZ2VQcmlvcml0eU1hcFthLnR5cGVdID8/IDYpO1xuICBjb25zdCBwcmlvcml0eUIgPSBpc0NYV2FyZWhvdXNlKGIpID8gMCA6IChzdG9yYWdlUHJpb3JpdHlNYXBbYi50eXBlXSA/PyA2KTtcbiAgaWYgKHByaW9yaXR5QSAhPT0gcHJpb3JpdHlCKSB7XG4gICAgcmV0dXJuIHByaW9yaXR5QSAtIHByaW9yaXR5QjtcbiAgfVxuXG4gIHJldHVybiBzZXJpYWxpemVTdG9yYWdlKGEpLmxvY2FsZUNvbXBhcmUoc2VyaWFsaXplU3RvcmFnZShiKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0NYV2FyZWhvdXNlKHN0b3JhZ2U6IFBydW5BcGkuU3RvcmUpIHtcbiAgaWYgKHN0b3JhZ2UudHlwZSAhPT0gJ1dBUkVIT1VTRV9TVE9SRScpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBjb25zdCB3YXJlaG91c2UgPSB3YXJlaG91c2VzU3RvcmUuZ2V0QnlJZChzdG9yYWdlLmFkZHJlc3NhYmxlSWQpO1xuICBjb25zdCBsb2NhdGlvbiA9IGdldExvY2F0aW9uTGluZUZyb21BZGRyZXNzKHdhcmVob3VzZT8uYWRkcmVzcyk7XG4gIHJldHVybiBsb2NhdGlvbj8udHlwZSA9PT0gJ1NUQVRJT04nO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXRTYW1lTG9jYXRpb24oc3RvcmFnZUE6IFBydW5BcGkuU3RvcmUsIHN0b3JhZ2VCOiBQcnVuQXBpLlN0b3JlKSB7XG4gIGlmIChzdG9yYWdlQSA9PT0gc3RvcmFnZUIpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBjb25zdCBhZGRyZXNzQSA9IGdldFN0b3JlQWRkcmVzcyhzdG9yYWdlQSk7XG4gIGNvbnN0IGFkZHJlc3NCID0gZ2V0U3RvcmVBZGRyZXNzKHN0b3JhZ2VCKTtcblxuICByZXR1cm4gaXNTYW1lQWRkcmVzcyhhZGRyZXNzQSwgYWRkcmVzc0IpO1xufVxuXG5mdW5jdGlvbiBnZXRTdG9yZUFkZHJlc3Moc3RvcmU6IFBydW5BcGkuU3RvcmUpIHtcbiAgc3dpdGNoIChzdG9yZS50eXBlKSB7XG4gICAgY2FzZSAnU1RPUkUnOiB7XG4gICAgICBjb25zdCBzaXRlID0gc2l0ZXNTdG9yZS5nZXRCeUlkKHN0b3JlLmFkZHJlc3NhYmxlSWQpO1xuICAgICAgcmV0dXJuIHNpdGU/LmFkZHJlc3M7XG4gICAgfVxuICAgIGNhc2UgJ1dBUkVIT1VTRV9TVE9SRSc6IHtcbiAgICAgIGNvbnN0IHdhcmVob3VzZSA9IHdhcmVob3VzZXNTdG9yZS5nZXRCeUlkKHN0b3JlLmFkZHJlc3NhYmxlSWQpO1xuICAgICAgcmV0dXJuIHdhcmVob3VzZT8uYWRkcmVzcztcbiAgICB9XG4gICAgY2FzZSAnU0hJUF9TVE9SRSc6XG4gICAgY2FzZSAnU1RMX0ZVRUxfU1RPUkUnOlxuICAgIGNhc2UgJ0ZUTF9GVUVMX1NUT1JFJzoge1xuICAgICAgY29uc3Qgc2hpcCA9IHNoaXBzU3RvcmUuZ2V0QnlJZChzdG9yZS5hZGRyZXNzYWJsZUlkKTtcbiAgICAgIHJldHVybiBzaGlwPy5hZGRyZXNzO1xuICAgIH1cbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBV08sU0FBUyxpQkFBaUIsU0FBd0I7QUFDdkQsVUFBUSxRQUFRLE1BQUE7QUFBQSxJQUNkLEtBQUs7QUFDSCxhQUFPLFFBQVEsT0FBTztBQUFBLElBQ3hCLEtBQUs7QUFDSCxhQUFPLFFBQVEsT0FBTztBQUFBLElBQ3hCLEtBQUs7QUFDSCxhQUFPLFFBQVEsT0FBTztBQUFB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
