import { castArray } from './cast-array.js';
function findWithQuery(query, find) {
  if (typeof query === 'string') {
    query = query
      .trim()
      .split(' ')
      .filter(x => x.length > 0);
  }
  query = query.map(x => x.toLowerCase());
  let include = [];
  const includeSet = /* @__PURE__ */ new Set();
  const exclude = /* @__PURE__ */ new Set();
  let includeAll = true;
  let excludeAll = false;
  let isNot = false;
  let nextTerm = '';
  const nextTermParts = [];
  while (query.length > 0) {
    const nextQueryPart = query.shift();
    nextTermParts.push(nextQueryPart);
    if (nextTerm.length === 0) {
      nextTerm = nextQueryPart;
    } else {
      nextTerm += ' ' + nextQueryPart;
    }
    if (nextTerm === 'not') {
      isNot = true;
      excludeAll = true;
      nextTerm = '';
      nextTermParts.length = 0;
      continue;
    }
    const match = find(nextTerm, nextTermParts);
    if (match === void 0) {
      continue;
    }
    const matches = castArray(match);
    if (!isNot) {
      includeAll = false;
      for (const item of matches) {
        if (!includeSet.has(item)) {
          include.push(item);
          includeSet.add(item);
        }
      }
    } else {
      excludeAll = false;
      for (const item of matches) {
        exclude.add(item);
      }
    }
    nextTerm = '';
    nextTermParts.length = 0;
  }
  include = include.filter(x => !exclude.has(x));
  return {
    include,
    exclude,
    includeAll,
    excludeAll,
  };
}
export { findWithQuery };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmluZC13aXRoLXF1ZXJ5LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvdXRpbHMvZmluZC13aXRoLXF1ZXJ5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNhc3RBcnJheSB9IGZyb20gJ0BzcmMvdXRpbHMvY2FzdC1hcnJheSc7XG5cbmludGVyZmFjZSBRdWVyeVJlc3VsdDxUPiB7XG4gIGluY2x1ZGU6IFRbXTtcbiAgZXhjbHVkZTogU2V0PFQ+O1xuICBpbmNsdWRlQWxsOiBib29sZWFuO1xuICBleGNsdWRlQWxsOiBib29sZWFuO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZmluZFdpdGhRdWVyeTxUPihcbiAgcXVlcnk6IHN0cmluZyB8IHN0cmluZ1tdLFxuICBmaW5kOiAodGVybTogc3RyaW5nLCBwYXJ0czogc3RyaW5nW10pID0+IFQgfCBUW10gfCB1bmRlZmluZWQsXG4pOiBRdWVyeVJlc3VsdDxUPiB7XG4gIGlmICh0eXBlb2YgcXVlcnkgPT09ICdzdHJpbmcnKSB7XG4gICAgcXVlcnkgPSBxdWVyeVxuICAgICAgLnRyaW0oKVxuICAgICAgLnNwbGl0KCcgJylcbiAgICAgIC5maWx0ZXIoeCA9PiB4Lmxlbmd0aCA+IDApO1xuICB9XG4gIHF1ZXJ5ID0gcXVlcnkubWFwKHggPT4geC50b0xvd2VyQ2FzZSgpKTtcblxuICBsZXQgaW5jbHVkZSA9IFtdIGFzIFRbXTtcbiAgY29uc3QgaW5jbHVkZVNldCA9IG5ldyBTZXQ8VD4oKTtcbiAgY29uc3QgZXhjbHVkZSA9IG5ldyBTZXQ8VD4oKTtcbiAgbGV0IGluY2x1ZGVBbGwgPSB0cnVlO1xuICBsZXQgZXhjbHVkZUFsbCA9IGZhbHNlO1xuXG4gIGxldCBpc05vdCA9IGZhbHNlO1xuXG4gIGxldCBuZXh0VGVybSA9ICcnO1xuICBjb25zdCBuZXh0VGVybVBhcnRzID0gW10gYXMgc3RyaW5nW107XG4gIHdoaWxlIChxdWVyeS5sZW5ndGggPiAwKSB7XG4gICAgLy8gQWNjdW11bGF0ZSB0ZXJtcyB1bnRpbCB3ZSBmaW5kIGEgbWF0Y2guIEZvciBleGFtcGxlLCAnTG9tIFBhbGFua2EnIGlzIGluaXRpYWxseSBzcGxpdCBpbnRvXG4gICAgLy8gJ0xvbScgYW5kICdQYWxhbmthJywgYnV0IHdlIG5lZWQgdG8gam9pbiB0aGVtIGludG8gJ0xvbSBQYWxhbmthJyB0byBtYXRjaC5cbiAgICBjb25zdCBuZXh0UXVlcnlQYXJ0ID0gcXVlcnkuc2hpZnQoKSE7XG4gICAgbmV4dFRlcm1QYXJ0cy5wdXNoKG5leHRRdWVyeVBhcnQpO1xuICAgIGlmIChuZXh0VGVybS5sZW5ndGggPT09IDApIHtcbiAgICAgIG5leHRUZXJtID0gbmV4dFF1ZXJ5UGFydDtcbiAgICB9IGVsc2Uge1xuICAgICAgbmV4dFRlcm0gKz0gJyAnICsgbmV4dFF1ZXJ5UGFydDtcbiAgICB9XG5cbiAgICBpZiAobmV4dFRlcm0gPT09ICdub3QnKSB7XG4gICAgICBpc05vdCA9IHRydWU7XG4gICAgICBleGNsdWRlQWxsID0gdHJ1ZTtcbiAgICAgIG5leHRUZXJtID0gJyc7XG4gICAgICBuZXh0VGVybVBhcnRzLmxlbmd0aCA9IDA7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBjb25zdCBtYXRjaCA9IGZpbmQobmV4dFRlcm0sIG5leHRUZXJtUGFydHMpO1xuICAgIGlmIChtYXRjaCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBjb25zdCBtYXRjaGVzID0gY2FzdEFycmF5KG1hdGNoKTtcbiAgICBpZiAoIWlzTm90KSB7XG4gICAgICBpbmNsdWRlQWxsID0gZmFsc2U7XG4gICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgbWF0Y2hlcykge1xuICAgICAgICBpZiAoIWluY2x1ZGVTZXQuaGFzKGl0ZW0pKSB7XG4gICAgICAgICAgaW5jbHVkZS5wdXNoKGl0ZW0pO1xuICAgICAgICAgIGluY2x1ZGVTZXQuYWRkKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGV4Y2x1ZGVBbGwgPSBmYWxzZTtcbiAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBtYXRjaGVzKSB7XG4gICAgICAgIGV4Y2x1ZGUuYWRkKGl0ZW0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIG5leHRUZXJtID0gJyc7XG4gICAgbmV4dFRlcm1QYXJ0cy5sZW5ndGggPSAwO1xuICB9XG5cbiAgaW5jbHVkZSA9IGluY2x1ZGUuZmlsdGVyKHggPT4gIWV4Y2x1ZGUuaGFzKHgpKTtcbiAgcmV0dXJuIHtcbiAgICBpbmNsdWRlLFxuICAgIGV4Y2x1ZGUsXG4gICAgaW5jbHVkZUFsbCxcbiAgICBleGNsdWRlQWxsLFxuICB9O1xufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFTTyxTQUFTLGNBQ2QsT0FDQSxNQUNnQjtBQUNoQixNQUFJLE9BQU8sVUFBVSxVQUFVO0FBQzdCLFlBQVEsTUFDTCxLQUFBLEVBQ0EsTUFBTSxHQUFHLEVBQ1QsT0FBTyxDQUFBLE1BQUssRUFBRSxTQUFTLENBQUM7QUFBQSxFQUM3QjtBQUNBLFVBQVEsTUFBTSxJQUFJLENBQUEsTUFBSyxFQUFFLGFBQWE7QUFFdEMsTUFBSSxVQUFVLENBQUE7QUFDZCxRQUFNLGlDQUFpQixJQUFBO0FBQ3ZCLFFBQU0sOEJBQWMsSUFBQTtBQUNwQixNQUFJLGFBQWE7QUFDakIsTUFBSSxhQUFhO0FBRWpCLE1BQUksUUFBUTtBQUVaLE1BQUksV0FBVztBQUNmLFFBQU0sZ0JBQWdCLENBQUE7QUFDdEIsU0FBTyxNQUFNLFNBQVMsR0FBRztBQUd2QixVQUFNLGdCQUFnQixNQUFNLE1BQUE7QUFDNUIsa0JBQWMsS0FBSyxhQUFhO0FBQ2hDLFFBQUksU0FBUyxXQUFXLEdBQUc7QUFDekIsaUJBQVc7QUFBQSxJQUNiLE9BQU87QUFDTCxrQkFBWSxNQUFNO0FBQUEsSUFDcEI7QUFFQSxRQUFJLGFBQWEsT0FBTztBQUN0QixjQUFRO0FBQ1IsbUJBQWE7QUFDYixpQkFBVztBQUNYLG9CQUFjLFNBQVM7QUFDdkI7QUFBQSxJQUNGO0FBRUEsVUFBTSxRQUFRLEtBQUssVUFBVSxhQUFhO0FBQzFDLFFBQUksVUFBVSxRQUFXO0FBQ3ZCO0FBQUEsSUFDRjtBQUVBLFVBQU0sVUFBVSxVQUFVLEtBQUs7QUFDL0IsUUFBSSxDQUFDLE9BQU87QUFDVixtQkFBYTtBQUNiLGlCQUFXLFFBQVEsU0FBUztBQUMxQixZQUFJLENBQUMsV0FBVyxJQUFJLElBQUksR0FBRztBQUN6QixrQkFBUSxLQUFLLElBQUk7QUFDakIscUJBQVcsSUFBSSxJQUFJO0FBQUEsUUFDckI7QUFBQSxNQUNGO0FBQUEsSUFDRixPQUFPO0FBQ0wsbUJBQWE7QUFDYixpQkFBVyxRQUFRLFNBQVM7QUFDMUIsZ0JBQVEsSUFBSSxJQUFJO0FBQUEsTUFDbEI7QUFBQSxJQUNGO0FBRUEsZUFBVztBQUNYLGtCQUFjLFNBQVM7QUFBQSxFQUN6QjtBQUVBLFlBQVUsUUFBUSxPQUFPLENBQUEsTUFBSyxDQUFDLFFBQVEsSUFBSSxDQUFDLENBQUM7QUFDN0MsU0FBTztBQUFBLElBQ0w7QUFBQSxJQUNBO0FBQUEsSUFDQTtBQUFBLElBQ0E7QUFBQSxFQUFBO0FBRUo7In0=
