import { createEntityStore } from './create-entity-store.js';
import { onApiMessage } from './api-messages.js';
import { createMapGetter } from './create-map-getter.js';
import { castArray } from './cast-array.js';
import { defaultExchanges } from './exchanges.default.js';
import { getEntityNaturalIdFromAddress } from './addresses.js';
import { isEmpty } from './is-empty.js';
const store = createEntityStore(x => x.id, { preserveOnConnectionOpen: true });
const state = store.state;
onApiMessage({
  CLIENT_CONNECTION_OPENED() {
    store.setAll(defaultExchanges);
    store.setFetched();
  },
  DATA_DATA(data) {
    if (isEmpty(data.path) || data.path[0] !== 'commodityexchanges') {
      return;
    }
    store.setMany(castArray(data.body));
  },
});
const getByNaturalId = createMapGetter(state.all, x => getEntityNaturalIdFromAddress(x.address));
const getByCode = createMapGetter(state.all, x => x.code);
const getByName = createMapGetter(state.all, x => x.name);
const getNaturalIdFromCode = code => getEntityNaturalIdFromAddress(getByCode(code)?.address);
const exchangesStore = {
  ...state,
  getByNaturalId,
  getByCode,
  getByName,
  getNaturalIdFromCode,
};
export { exchangesStore };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhjaGFuZ2VzLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvaW5mcmFzdHJ1Y3R1cmUvcHJ1bi1hcGkvZGF0YS9leGNoYW5nZXMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlRW50aXR5U3RvcmUgfSBmcm9tICdAc3JjL2luZnJhc3RydWN0dXJlL3BydW4tYXBpL2RhdGEvY3JlYXRlLWVudGl0eS1zdG9yZSc7XG5pbXBvcnQgeyBvbkFwaU1lc3NhZ2UgfSBmcm9tICdAc3JjL2luZnJhc3RydWN0dXJlL3BydW4tYXBpL2RhdGEvYXBpLW1lc3NhZ2VzJztcbmltcG9ydCB7IGNyZWF0ZU1hcEdldHRlciB9IGZyb20gJ0BzcmMvaW5mcmFzdHJ1Y3R1cmUvcHJ1bi1hcGkvZGF0YS9jcmVhdGUtbWFwLWdldHRlcic7XG5pbXBvcnQgeyBjYXN0QXJyYXkgfSBmcm9tICdAc3JjL3V0aWxzL2Nhc3QtYXJyYXknO1xuaW1wb3J0IHsgaXNFbXB0eSB9IGZyb20gJ3RzLWV4dHJhcyc7XG5pbXBvcnQgeyBkZWZhdWx0RXhjaGFuZ2VzIH0gZnJvbSAnQHNyYy9pbmZyYXN0cnVjdHVyZS9wcnVuLWFwaS9kYXRhL2V4Y2hhbmdlcy5kZWZhdWx0JztcbmltcG9ydCB7IGdldEVudGl0eU5hdHVyYWxJZEZyb21BZGRyZXNzIH0gZnJvbSAnQHNyYy9pbmZyYXN0cnVjdHVyZS9wcnVuLWFwaS9kYXRhL2FkZHJlc3Nlcyc7XG5cbmNvbnN0IHN0b3JlID0gY3JlYXRlRW50aXR5U3RvcmU8UHJ1bkFwaS5FeGNoYW5nZT4oeCA9PiB4LmlkLCB7IHByZXNlcnZlT25Db25uZWN0aW9uT3BlbjogdHJ1ZSB9KTtcbmNvbnN0IHN0YXRlID0gc3RvcmUuc3RhdGU7XG5cbm9uQXBpTWVzc2FnZSh7XG4gIENMSUVOVF9DT05ORUNUSU9OX09QRU5FRCgpIHtcbiAgICBzdG9yZS5zZXRBbGwoZGVmYXVsdEV4Y2hhbmdlcyk7XG4gICAgc3RvcmUuc2V0RmV0Y2hlZCgpO1xuICB9LFxuICBEQVRBX0RBVEEoZGF0YTogeyBib2R5OiBBcnJheWFibGU8UHJ1bkFwaS5FeGNoYW5nZT47IHBhdGg6IHN0cmluZ1tdIH0pIHtcbiAgICBpZiAoaXNFbXB0eShkYXRhLnBhdGgpIHx8IGRhdGEucGF0aFswXSAhPT0gJ2NvbW1vZGl0eWV4Y2hhbmdlcycpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc3RvcmUuc2V0TWFueShjYXN0QXJyYXkoZGF0YS5ib2R5KSk7XG4gIH0sXG59KTtcblxuY29uc3QgZ2V0QnlOYXR1cmFsSWQgPSBjcmVhdGVNYXBHZXR0ZXIoc3RhdGUuYWxsLCB4ID0+IGdldEVudGl0eU5hdHVyYWxJZEZyb21BZGRyZXNzKHguYWRkcmVzcykhKTtcblxuY29uc3QgZ2V0QnlDb2RlID0gY3JlYXRlTWFwR2V0dGVyKHN0YXRlLmFsbCwgeCA9PiB4LmNvZGUpO1xuXG5jb25zdCBnZXRCeU5hbWUgPSBjcmVhdGVNYXBHZXR0ZXIoc3RhdGUuYWxsLCB4ID0+IHgubmFtZSk7XG5cbmNvbnN0IGdldE5hdHVyYWxJZEZyb21Db2RlID0gKGNvZGU/OiBzdHJpbmcgfCBudWxsKSA9PlxuICBnZXRFbnRpdHlOYXR1cmFsSWRGcm9tQWRkcmVzcyhnZXRCeUNvZGUoY29kZSk/LmFkZHJlc3MpO1xuXG5leHBvcnQgY29uc3QgZXhjaGFuZ2VzU3RvcmUgPSB7XG4gIC4uLnN0YXRlLFxuICBnZXRCeU5hdHVyYWxJZCxcbiAgZ2V0QnlDb2RlLFxuICBnZXRCeU5hbWUsXG4gIGdldE5hdHVyYWxJZEZyb21Db2RlLFxufTtcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBUUEsTUFBTSxRQUFRLGtCQUFvQyxDQUFBLE1BQUssRUFBRSxJQUFJLEVBQUUsMEJBQTBCLE1BQU07QUFDL0YsTUFBTSxRQUFRLE1BQU07QUFFcEIsYUFBYTtBQUFBLEVBQ1gsMkJBQTJCO0FBQ3pCLFVBQU0sT0FBTyxnQkFBZ0I7QUFDN0IsVUFBTSxXQUFBO0FBQUEsRUFDUjtBQUFBLEVBQ0EsVUFBVSxNQUE2RDtBQUNyRSxRQUFJLFFBQVEsS0FBSyxJQUFJLEtBQUssS0FBSyxLQUFLLENBQUMsTUFBTSxzQkFBc0I7QUFDL0Q7QUFBQSxJQUNGO0FBQ0EsVUFBTSxRQUFRLFVBQVUsS0FBSyxJQUFJLENBQUM7QUFBQSxFQUNwQztBQUNGLENBQUM7QUFFRCxNQUFNLGlCQUFpQixnQkFBZ0IsTUFBTSxLQUFLLE9BQUssOEJBQThCLEVBQUUsT0FBTyxDQUFFO0FBRWhHLE1BQU0sWUFBWSxnQkFBZ0IsTUFBTSxLQUFLLENBQUEsTUFBSyxFQUFFLElBQUk7QUFFeEQsTUFBTSxZQUFZLGdCQUFnQixNQUFNLEtBQUssQ0FBQSxNQUFLLEVBQUUsSUFBSTtBQUV4RCxNQUFNLHVCQUF1QixDQUFDLFNBQzVCLDhCQUE4QixVQUFVLElBQUksR0FBRyxPQUFPO0FBRWpELE1BQU0saUJBQWlCO0FBQUEsRUFDNUIsR0FBRztBQUFBLEVBQ0g7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFDRjsifQ==
