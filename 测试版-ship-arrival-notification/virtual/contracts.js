import { createEntityStore } from './create-entity-store.js';
import { onApiMessage } from './api-messages.js';
import { createMapGetter } from './create-map-getter.js';
import { computed } from './runtime-core.esm-bundler.js';
const store = createEntityStore();
const state = store.state;
onApiMessage({
  CONTRACTS_CONTRACTS(data) {
    store.setAll(data.contracts);
    store.setFetched();
  },
  CONTRACTS_CONTRACT(data) {
    store.setOne(data);
  },
});
const getByLocalId = createMapGetter(state.all, x => x.localId);
function getByShipmentId(id) {
  if (!id) {
    return void 0;
  }
  const all = state.all.value;
  if (all === void 0) {
    return void 0;
  }
  for (const contract of all) {
    const condition = contract.conditions.find(
      x => x.type === 'DELIVERY_SHIPMENT' && x.shipmentItemId?.startsWith(id),
    );
    if (condition) {
      return contract;
    }
  }
  return void 0;
}
function getDestinationByShipmentId(id) {
  return getDeliveryConditionByShipmentId(id)?.destination;
}
function getDeliveryConditionByShipmentId(id) {
  if (!id) {
    return void 0;
  }
  const all = state.all.value;
  if (all === void 0) {
    return void 0;
  }
  for (const contract of all) {
    for (const condition of contract.conditions) {
      if (
        condition.type === 'PROVISION_SHIPMENT' &&
        condition.blockId?.toLowerCase().startsWith(id.toLowerCase())
      ) {
        const delivery = contract.conditions.find(x => x.type === 'DELIVERY_SHIPMENT');
        if (delivery) {
          return delivery;
        }
      }
      if (
        condition.type === 'DELIVERY_SHIPMENT' &&
        condition.shipmentItemId?.toLowerCase().startsWith(id.toLowerCase())
      ) {
        return condition;
      }
    }
  }
  return void 0;
}
const active = computed(() =>
  state.all.value?.filter(
    x =>
      x.status === 'CLOSED' ||
      x.status === 'PARTIALLY_FULFILLED' ||
      x.status === 'DEADLINE_EXCEEDED',
  ),
);
const contractsStore = {
  ...state,
  active,
  getByLocalId,
  getByShipmentId,
  getDestinationByShipmentId,
};
function isFactionContract(contract) {
  return contract.partner.countryCode !== void 0;
}
export { active, contractsStore, isFactionContract };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJhY3RzLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvaW5mcmFzdHJ1Y3R1cmUvcHJ1bi1hcGkvZGF0YS9jb250cmFjdHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlRW50aXR5U3RvcmUgfSBmcm9tICdAc3JjL2luZnJhc3RydWN0dXJlL3BydW4tYXBpL2RhdGEvY3JlYXRlLWVudGl0eS1zdG9yZSc7XG5pbXBvcnQgeyBvbkFwaU1lc3NhZ2UgfSBmcm9tICdAc3JjL2luZnJhc3RydWN0dXJlL3BydW4tYXBpL2RhdGEvYXBpLW1lc3NhZ2VzJztcbmltcG9ydCB7IGNyZWF0ZU1hcEdldHRlciB9IGZyb20gJ0BzcmMvaW5mcmFzdHJ1Y3R1cmUvcHJ1bi1hcGkvZGF0YS9jcmVhdGUtbWFwLWdldHRlcic7XG5cbmNvbnN0IHN0b3JlID0gY3JlYXRlRW50aXR5U3RvcmU8UHJ1bkFwaS5Db250cmFjdD4oKTtcbmNvbnN0IHN0YXRlID0gc3RvcmUuc3RhdGU7XG5cbm9uQXBpTWVzc2FnZSh7XG4gIENPTlRSQUNUU19DT05UUkFDVFMoZGF0YTogeyBjb250cmFjdHM6IFBydW5BcGkuQ29udHJhY3RbXSB9KSB7XG4gICAgc3RvcmUuc2V0QWxsKGRhdGEuY29udHJhY3RzKTtcbiAgICBzdG9yZS5zZXRGZXRjaGVkKCk7XG4gIH0sXG4gIENPTlRSQUNUU19DT05UUkFDVChkYXRhOiBQcnVuQXBpLkNvbnRyYWN0KSB7XG4gICAgc3RvcmUuc2V0T25lKGRhdGEpO1xuICB9LFxufSk7XG5cbmNvbnN0IGdldEJ5TG9jYWxJZCA9IGNyZWF0ZU1hcEdldHRlcihzdGF0ZS5hbGwsIHggPT4geC5sb2NhbElkKTtcblxuZnVuY3Rpb24gZ2V0QnlTaGlwbWVudElkKGlkPzogc3RyaW5nIHwgbnVsbCkge1xuICBpZiAoIWlkKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGNvbnN0IGFsbCA9IHN0YXRlLmFsbC52YWx1ZTtcbiAgaWYgKGFsbCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGZvciAoY29uc3QgY29udHJhY3Qgb2YgYWxsKSB7XG4gICAgY29uc3QgY29uZGl0aW9uID0gY29udHJhY3QuY29uZGl0aW9ucy5maW5kKFxuICAgICAgeCA9PiB4LnR5cGUgPT09ICdERUxJVkVSWV9TSElQTUVOVCcgJiYgeC5zaGlwbWVudEl0ZW1JZD8uc3RhcnRzV2l0aChpZCksXG4gICAgKTtcbiAgICBpZiAoY29uZGl0aW9uKSB7XG4gICAgICByZXR1cm4gY29udHJhY3Q7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cblxuZnVuY3Rpb24gZ2V0RGVzdGluYXRpb25CeVNoaXBtZW50SWQoaWQ/OiBzdHJpbmcgfCBudWxsKSB7XG4gIHJldHVybiBnZXREZWxpdmVyeUNvbmRpdGlvbkJ5U2hpcG1lbnRJZChpZCk/LmRlc3RpbmF0aW9uO1xufVxuXG5mdW5jdGlvbiBnZXREZWxpdmVyeUNvbmRpdGlvbkJ5U2hpcG1lbnRJZChpZD86IHN0cmluZyB8IG51bGwpIHtcbiAgaWYgKCFpZCkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBjb25zdCBhbGwgPSBzdGF0ZS5hbGwudmFsdWU7XG4gIGlmIChhbGwgPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBmb3IgKGNvbnN0IGNvbnRyYWN0IG9mIGFsbCkge1xuICAgIGZvciAoY29uc3QgY29uZGl0aW9uIG9mIGNvbnRyYWN0LmNvbmRpdGlvbnMpIHtcbiAgICAgIGlmIChcbiAgICAgICAgY29uZGl0aW9uLnR5cGUgPT09ICdQUk9WSVNJT05fU0hJUE1FTlQnICYmXG4gICAgICAgIGNvbmRpdGlvbi5ibG9ja0lkPy50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoaWQudG9Mb3dlckNhc2UoKSlcbiAgICAgICkge1xuICAgICAgICBjb25zdCBkZWxpdmVyeSA9IGNvbnRyYWN0LmNvbmRpdGlvbnMuZmluZCh4ID0+IHgudHlwZSA9PT0gJ0RFTElWRVJZX1NISVBNRU5UJyk7XG4gICAgICAgIGlmIChkZWxpdmVyeSkge1xuICAgICAgICAgIHJldHVybiBkZWxpdmVyeTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKFxuICAgICAgICBjb25kaXRpb24udHlwZSA9PT0gJ0RFTElWRVJZX1NISVBNRU5UJyAmJlxuICAgICAgICBjb25kaXRpb24uc2hpcG1lbnRJdGVtSWQ/LnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChpZC50b0xvd2VyQ2FzZSgpKVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiBjb25kaXRpb247XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cblxuZXhwb3J0IGNvbnN0IGFjdGl2ZSA9IGNvbXB1dGVkKCgpID0+XG4gIHN0YXRlLmFsbC52YWx1ZT8uZmlsdGVyKFxuICAgIHggPT5cbiAgICAgIHguc3RhdHVzID09PSAnQ0xPU0VEJyB8fFxuICAgICAgeC5zdGF0dXMgPT09ICdQQVJUSUFMTFlfRlVMRklMTEVEJyB8fFxuICAgICAgeC5zdGF0dXMgPT09ICdERUFETElORV9FWENFRURFRCcsXG4gICksXG4pO1xuXG5leHBvcnQgY29uc3QgY29udHJhY3RzU3RvcmUgPSB7XG4gIC4uLnN0YXRlLFxuICBhY3RpdmUsXG4gIGdldEJ5TG9jYWxJZCxcbiAgZ2V0QnlTaGlwbWVudElkLFxuICBnZXREZXN0aW5hdGlvbkJ5U2hpcG1lbnRJZCxcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0ZhY3Rpb25Db250cmFjdChjb250cmFjdDogUHJ1bkFwaS5Db250cmFjdCkge1xuICByZXR1cm4gY29udHJhY3QucGFydG5lci5jb3VudHJ5Q29kZSAhPT0gdW5kZWZpbmVkO1xufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFJQSxNQUFBLFFBQUEsa0JBQUE7QUFDQSxNQUFBLFFBQUEsTUFBQTtBQUVBLGFBQUE7QUFBQSxFQUFhLG9CQUFBLE1BQUE7QUFFVCxVQUFBLE9BQUEsS0FBQSxTQUFBO0FBQ0EsVUFBQSxXQUFBO0FBQUEsRUFBaUI7QUFBQSxFQUNuQixtQkFBQSxNQUFBO0FBRUUsVUFBQSxPQUFBLElBQUE7QUFBQSxFQUFpQjtBQUVyQixDQUFBO0FBRUEsTUFBQSxlQUFBLGdCQUFBLE1BQUEsS0FBQSxDQUFBLE1BQUEsRUFBQSxPQUFBO0FBRUEsU0FBQSxnQkFBQSxJQUFBO0FBQ0UsTUFBQSxDQUFBLElBQUE7QUFDRSxXQUFBO0FBQUEsRUFBTztBQUdULFFBQUEsTUFBQSxNQUFBLElBQUE7QUFDQSxNQUFBLFFBQUEsUUFBQTtBQUNFLFdBQUE7QUFBQSxFQUFPO0FBR1QsYUFBQSxZQUFBLEtBQUE7QUFDRSxVQUFBLFlBQUEsU0FBQSxXQUFBO0FBQUEsTUFBc0MsQ0FBQSxNQUFBLEVBQUEsU0FBQSx1QkFBQSxFQUFBLGdCQUFBLFdBQUEsRUFBQTtBQUFBLElBQ2tDO0FBRXhFLFFBQUEsV0FBQTtBQUNFLGFBQUE7QUFBQSxJQUFPO0FBQUEsRUFDVDtBQUdGLFNBQUE7QUFDRjtBQUVBLFNBQUEsMkJBQUEsSUFBQTtBQUNFLFNBQUEsaUNBQUEsRUFBQSxHQUFBO0FBQ0Y7QUFFQSxTQUFBLGlDQUFBLElBQUE7QUFDRSxNQUFBLENBQUEsSUFBQTtBQUNFLFdBQUE7QUFBQSxFQUFPO0FBR1QsUUFBQSxNQUFBLE1BQUEsSUFBQTtBQUNBLE1BQUEsUUFBQSxRQUFBO0FBQ0UsV0FBQTtBQUFBLEVBQU87QUFHVCxhQUFBLFlBQUEsS0FBQTtBQUNFLGVBQUEsYUFBQSxTQUFBLFlBQUE7QUFDRSxVQUFBLFVBQUEsU0FBQSx3QkFBQSxVQUFBLFNBQUEsWUFBQSxFQUFBLFdBQUEsR0FBQSxZQUFBLENBQUEsR0FBQTtBQUlFLGNBQUEsV0FBQSxTQUFBLFdBQUEsS0FBQSxDQUFBLE1BQUEsRUFBQSxTQUFBLG1CQUFBO0FBQ0EsWUFBQSxVQUFBO0FBQ0UsaUJBQUE7QUFBQSxRQUFPO0FBQUEsTUFDVDtBQUVGLFVBQUEsVUFBQSxTQUFBLHVCQUFBLFVBQUEsZ0JBQUEsWUFBQSxFQUFBLFdBQUEsR0FBQSxZQUFBLENBQUEsR0FBQTtBQUlFLGVBQUE7QUFBQSxNQUFPO0FBQUEsSUFDVDtBQUFBLEVBQ0Y7QUFHRixTQUFBO0FBQ0Y7QUFFTyxNQUFBLFNBQUE7QUFBQSxFQUFlLE1BQUEsTUFBQSxJQUFBLE9BQUE7QUFBQSxJQUNILENBQUEsTUFBQSxFQUFBLFdBQUEsWUFBQSxFQUFBLFdBQUEseUJBQUEsRUFBQSxXQUFBO0FBQUEsRUFJQTtBQUVuQjtBQUVPLE1BQUEsaUJBQUE7QUFBQSxFQUF1QixHQUFBO0FBQUEsRUFDekI7QUFBQSxFQUNIO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFFRjtBQUVPLFNBQUEsa0JBQUEsVUFBQTtBQUNMLFNBQUEsU0FBQSxRQUFBLGdCQUFBO0FBQ0Y7In0=
