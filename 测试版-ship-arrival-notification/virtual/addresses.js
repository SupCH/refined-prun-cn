import { onApiMessage } from './api-messages.js';
import { shallowReactive } from './reactivity.esm-bundler.js';
const state = shallowReactive({});
onApiMessage({
  SHIP_SHIPS(data) {
    for (const ship of data.ships) {
      state[ship.id] = ship.address;
    }
  },
  SHIP_DATA(data) {
    state[data.id] = data.address;
  },
  SITE_SITES(data) {
    for (const storage of data.sites) {
      state[storage.siteId] = storage.address;
    }
  },
  SITE_SITE(data) {
    state[data.siteId] = data.address;
  },
  WAREHOUSE_STORAGES(data) {
    for (const storage of data.storages) {
      state[storage.storeId] = storage.address;
    }
  },
  WAREHOUSE_STORAGE(data) {
    state[data.storeId] = data.address;
  },
});
({
  ...state,
});
const getEntityNaturalIdFromAddress = address => {
  return getLocationLineFromAddress(address)?.entity.naturalId;
};
const getEntityNameFromAddress = address => {
  const location = getLocationLineFromAddress(address);
  if (!location) {
    return void 0;
  }
  if (location.type !== 'PLANET' || location.entity.name !== location.entity.naturalId) {
    return location.entity.name;
  }
  const system = getSystemLineFromAddress(address);
  if (!system || system.entity.name === system.entity.naturalId) {
    return location.entity.name;
  }
  return location.entity.name.replace(system.entity.naturalId, `${system.entity.name} `);
};
const getSystemLineFromAddress = address => {
  if (!address) {
    return void 0;
  }
  return isSystemLine(address.lines[0]) ? address.lines[0] : address.lines.find(isSystemLine);
};
const getLocationLineFromAddress = address => {
  if (!address) {
    return void 0;
  }
  return isLocationLine(address.lines[1]) ? address.lines[1] : address.lines.find(isLocationLine);
};
function getDestinationName(destination) {
  if (!destination) {
    return void 0;
  }
  const location = getLocationLineFromAddress(destination);
  if (location?.type === 'STATION') {
    return location.entity.naturalId;
  }
  return getEntityNameFromAddress(destination);
}
function getDestinationFullName(destination) {
  if (!destination) {
    return void 0;
  }
  const location = getLocationLineFromAddress(destination);
  if (location?.type === 'STATION') {
    return location.entity.name;
  }
  const system = destination.lines[0];
  const planet = destination.lines[1];
  if (system === void 0) {
    return void 0;
  }
  if (planet === void 0) {
    return system.entity.name;
  }
  const isPlanetNamed = planet.entity.name !== planet.entity.naturalId;
  if (isPlanetNamed) {
    return `${system.entity.name} - ${planet.entity.name}`;
  }
  const planetLetter = planet.entity.naturalId.replace(system.entity.naturalId, '');
  return `${system.entity.name} ${planetLetter}`;
}
function isSystemLine(line) {
  return line?.type === 'SYSTEM';
}
function isLocationLine(line) {
  return line?.type === 'PLANET' || line?.type === 'STATION';
}
function isSameAddress(addressA, addressB) {
  if (!addressA || !addressB) {
    return false;
  }
  if (addressA === addressB) {
    return true;
  }
  for (let i = 0; i < addressA.lines.length; i++) {
    const lineA = addressA.lines[i];
    const lineB = addressB.lines[i];
    if (lineA === void 0 || lineB === void 0 || lineA.entity.id !== lineB.entity.id) {
      return false;
    }
  }
  return true;
}
export {
  getDestinationFullName,
  getDestinationName,
  getEntityNameFromAddress,
  getEntityNaturalIdFromAddress,
  getLocationLineFromAddress,
  getSystemLineFromAddress,
  isSameAddress,
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRkcmVzc2VzLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvaW5mcmFzdHJ1Y3R1cmUvcHJ1bi1hcGkvZGF0YS9hZGRyZXNzZXMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgb25BcGlNZXNzYWdlIH0gZnJvbSAnQHNyYy9pbmZyYXN0cnVjdHVyZS9wcnVuLWFwaS9kYXRhL2FwaS1tZXNzYWdlcyc7XG5cbnR5cGUgU3RhdGUgPSBSZWNvcmQ8c3RyaW5nLCBQcnVuQXBpLkFkZHJlc3MgfCBudWxsIHwgdW5kZWZpbmVkPjtcblxuY29uc3Qgc3RhdGUgPSBzaGFsbG93UmVhY3RpdmU8U3RhdGU+KHt9KTtcblxub25BcGlNZXNzYWdlKHtcbiAgU0hJUF9TSElQUyhkYXRhOiB7IHNoaXBzOiBQcnVuQXBpLlNoaXBbXSB9KSB7XG4gICAgZm9yIChjb25zdCBzaGlwIG9mIGRhdGEuc2hpcHMpIHtcbiAgICAgIHN0YXRlW3NoaXAuaWRdID0gc2hpcC5hZGRyZXNzO1xuICAgIH1cbiAgfSxcbiAgU0hJUF9EQVRBKGRhdGE6IFBydW5BcGkuU2hpcCkge1xuICAgIHN0YXRlW2RhdGEuaWRdID0gZGF0YS5hZGRyZXNzO1xuICB9LFxuICBTSVRFX1NJVEVTKGRhdGE6IHsgc2l0ZXM6IFBydW5BcGkuU2l0ZVtdIH0pIHtcbiAgICBmb3IgKGNvbnN0IHN0b3JhZ2Ugb2YgZGF0YS5zaXRlcykge1xuICAgICAgc3RhdGVbc3RvcmFnZS5zaXRlSWRdID0gc3RvcmFnZS5hZGRyZXNzO1xuICAgIH1cbiAgfSxcbiAgU0lURV9TSVRFKGRhdGE6IFBydW5BcGkuU2l0ZSkge1xuICAgIHN0YXRlW2RhdGEuc2l0ZUlkXSA9IGRhdGEuYWRkcmVzcztcbiAgfSxcbiAgV0FSRUhPVVNFX1NUT1JBR0VTKGRhdGE6IHsgc3RvcmFnZXM6IFBydW5BcGkuV2FyZWhvdXNlW10gfSkge1xuICAgIGZvciAoY29uc3Qgc3RvcmFnZSBvZiBkYXRhLnN0b3JhZ2VzKSB7XG4gICAgICBzdGF0ZVtzdG9yYWdlLnN0b3JlSWRdID0gc3RvcmFnZS5hZGRyZXNzO1xuICAgIH1cbiAgfSxcbiAgV0FSRUhPVVNFX1NUT1JBR0UoZGF0YTogUHJ1bkFwaS5XYXJlaG91c2UpIHtcbiAgICBzdGF0ZVtkYXRhLnN0b3JlSWRdID0gZGF0YS5hZGRyZXNzO1xuICB9LFxufSk7XG5cbmV4cG9ydCBjb25zdCBhZGRyZXNzZXNTdG9yZSA9IHtcbiAgLi4uc3RhdGUsXG59O1xuXG5leHBvcnQgY29uc3QgZ2V0RW50aXR5TmF0dXJhbElkRnJvbUFkZHJlc3MgPSAoYWRkcmVzcz86IFBydW5BcGkuQWRkcmVzcyB8IHVuZGVmaW5lZCkgPT4ge1xuICByZXR1cm4gZ2V0TG9jYXRpb25MaW5lRnJvbUFkZHJlc3MoYWRkcmVzcyk/LmVudGl0eS5uYXR1cmFsSWQ7XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0RW50aXR5TmFtZUZyb21BZGRyZXNzID0gKGFkZHJlc3M/OiBQcnVuQXBpLkFkZHJlc3MgfCB1bmRlZmluZWQpID0+IHtcbiAgY29uc3QgbG9jYXRpb24gPSBnZXRMb2NhdGlvbkxpbmVGcm9tQWRkcmVzcyhhZGRyZXNzKTtcbiAgaWYgKCFsb2NhdGlvbikge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBpZiAobG9jYXRpb24udHlwZSAhPT0gJ1BMQU5FVCcgfHwgbG9jYXRpb24uZW50aXR5Lm5hbWUgIT09IGxvY2F0aW9uLmVudGl0eS5uYXR1cmFsSWQpIHtcbiAgICByZXR1cm4gbG9jYXRpb24uZW50aXR5Lm5hbWU7XG4gIH1cblxuICBjb25zdCBzeXN0ZW0gPSBnZXRTeXN0ZW1MaW5lRnJvbUFkZHJlc3MoYWRkcmVzcyk7XG4gIGlmICghc3lzdGVtIHx8IHN5c3RlbS5lbnRpdHkubmFtZSA9PT0gc3lzdGVtLmVudGl0eS5uYXR1cmFsSWQpIHtcbiAgICByZXR1cm4gbG9jYXRpb24uZW50aXR5Lm5hbWU7XG4gIH1cblxuICByZXR1cm4gbG9jYXRpb24uZW50aXR5Lm5hbWUucmVwbGFjZShzeXN0ZW0uZW50aXR5Lm5hdHVyYWxJZCwgYCR7c3lzdGVtLmVudGl0eS5uYW1lfSBgKTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRTeXN0ZW1MaW5lRnJvbUFkZHJlc3MgPSAoYWRkcmVzcz86IFBydW5BcGkuQWRkcmVzcyB8IHVuZGVmaW5lZCkgPT4ge1xuICBpZiAoIWFkZHJlc3MpIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG4gIHJldHVybiBpc1N5c3RlbUxpbmUoYWRkcmVzcy5saW5lc1swXSkgPyBhZGRyZXNzLmxpbmVzWzBdIDogYWRkcmVzcy5saW5lcy5maW5kKGlzU3lzdGVtTGluZSk7XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0TG9jYXRpb25MaW5lRnJvbUFkZHJlc3MgPSAoYWRkcmVzcz86IFBydW5BcGkuQWRkcmVzcyB8IHVuZGVmaW5lZCkgPT4ge1xuICBpZiAoIWFkZHJlc3MpIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG4gIHJldHVybiBpc0xvY2F0aW9uTGluZShhZGRyZXNzLmxpbmVzWzFdKSA/IGFkZHJlc3MubGluZXNbMV0gOiBhZGRyZXNzLmxpbmVzLmZpbmQoaXNMb2NhdGlvbkxpbmUpO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldERlc3RpbmF0aW9uTmFtZShkZXN0aW5hdGlvbj86IFBydW5BcGkuQWRkcmVzcykge1xuICBpZiAoIWRlc3RpbmF0aW9uKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGNvbnN0IGxvY2F0aW9uID0gZ2V0TG9jYXRpb25MaW5lRnJvbUFkZHJlc3MoZGVzdGluYXRpb24pO1xuICBpZiAobG9jYXRpb24/LnR5cGUgPT09ICdTVEFUSU9OJykge1xuICAgIHJldHVybiBsb2NhdGlvbi5lbnRpdHkubmF0dXJhbElkO1xuICB9XG5cbiAgcmV0dXJuIGdldEVudGl0eU5hbWVGcm9tQWRkcmVzcyhkZXN0aW5hdGlvbik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXREZXN0aW5hdGlvbkZ1bGxOYW1lKGRlc3RpbmF0aW9uPzogUHJ1bkFwaS5BZGRyZXNzKSB7XG4gIGlmICghZGVzdGluYXRpb24pIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgY29uc3QgbG9jYXRpb24gPSBnZXRMb2NhdGlvbkxpbmVGcm9tQWRkcmVzcyhkZXN0aW5hdGlvbik7XG4gIGlmIChsb2NhdGlvbj8udHlwZSA9PT0gJ1NUQVRJT04nKSB7XG4gICAgcmV0dXJuIGxvY2F0aW9uLmVudGl0eS5uYW1lO1xuICB9XG5cbiAgY29uc3Qgc3lzdGVtID0gZGVzdGluYXRpb24ubGluZXNbMF07XG4gIGNvbnN0IHBsYW5ldCA9IGRlc3RpbmF0aW9uLmxpbmVzWzFdO1xuXG4gIGlmIChzeXN0ZW0gPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBpZiAocGxhbmV0ID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gc3lzdGVtLmVudGl0eS5uYW1lO1xuICB9XG5cbiAgY29uc3QgaXNQbGFuZXROYW1lZCA9IHBsYW5ldC5lbnRpdHkubmFtZSAhPT0gcGxhbmV0LmVudGl0eS5uYXR1cmFsSWQ7XG5cbiAgaWYgKGlzUGxhbmV0TmFtZWQpIHtcbiAgICByZXR1cm4gYCR7c3lzdGVtLmVudGl0eS5uYW1lfSAtICR7cGxhbmV0LmVudGl0eS5uYW1lfWA7XG4gIH1cblxuICBjb25zdCBwbGFuZXRMZXR0ZXIgPSBwbGFuZXQuZW50aXR5Lm5hdHVyYWxJZC5yZXBsYWNlKHN5c3RlbS5lbnRpdHkubmF0dXJhbElkLCAnJyk7XG4gIHJldHVybiBgJHtzeXN0ZW0uZW50aXR5Lm5hbWV9ICR7cGxhbmV0TGV0dGVyfWA7XG59XG5cbmZ1bmN0aW9uIGlzU3lzdGVtTGluZShsaW5lPzogUHJ1bkFwaS5BZGRyZXNzTGluZSkge1xuICByZXR1cm4gbGluZT8udHlwZSA9PT0gJ1NZU1RFTSc7XG59XG5cbmZ1bmN0aW9uIGlzTG9jYXRpb25MaW5lKGxpbmU/OiBQcnVuQXBpLkFkZHJlc3NMaW5lKSB7XG4gIHJldHVybiBsaW5lPy50eXBlID09PSAnUExBTkVUJyB8fCBsaW5lPy50eXBlID09PSAnU1RBVElPTic7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1NhbWVBZGRyZXNzKFxuICBhZGRyZXNzQT86IFBydW5BcGkuQWRkcmVzcyB8IG51bGwsXG4gIGFkZHJlc3NCPzogUHJ1bkFwaS5BZGRyZXNzIHwgbnVsbCxcbikge1xuICBpZiAoIWFkZHJlc3NBIHx8ICFhZGRyZXNzQikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGlmIChhZGRyZXNzQSA9PT0gYWRkcmVzc0IpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYWRkcmVzc0EubGluZXMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBsaW5lQSA9IGFkZHJlc3NBLmxpbmVzW2ldO1xuICAgIGNvbnN0IGxpbmVCID0gYWRkcmVzc0IubGluZXNbaV07XG4gICAgaWYgKGxpbmVBID09PSB1bmRlZmluZWQgfHwgbGluZUIgPT09IHVuZGVmaW5lZCB8fCBsaW5lQS5lbnRpdHkuaWQgIT09IGxpbmVCLmVudGl0eS5pZCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBSUEsTUFBQSxRQUFBLGdCQUFBLEVBQUE7QUFFQSxhQUFBO0FBQUEsRUFBYSxXQUFBLE1BQUE7QUFFVCxlQUFBLFFBQUEsS0FBQSxPQUFBO0FBQ0UsWUFBQSxLQUFBLEVBQUEsSUFBQSxLQUFBO0FBQUEsSUFBc0I7QUFBQSxFQUN4QjtBQUFBLEVBQ0YsVUFBQSxNQUFBO0FBRUUsVUFBQSxLQUFBLEVBQUEsSUFBQSxLQUFBO0FBQUEsRUFBc0I7QUFBQSxFQUN4QixXQUFBLE1BQUE7QUFFRSxlQUFBLFdBQUEsS0FBQSxPQUFBO0FBQ0UsWUFBQSxRQUFBLE1BQUEsSUFBQSxRQUFBO0FBQUEsSUFBZ0M7QUFBQSxFQUNsQztBQUFBLEVBQ0YsVUFBQSxNQUFB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
