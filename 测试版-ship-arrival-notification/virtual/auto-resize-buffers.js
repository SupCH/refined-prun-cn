import { C } from './prun-css.js';
import { $ } from './select-dom.js';
import tiles from './tiles.js';
import features from './feature-registry.js';
import { matchBufferSize } from './buffer-sizes.js';
import { setBufferSize } from './buffers.js';
const pastWindows = /* @__PURE__ */ new WeakSet();
async function onTileReady(tile) {
  if (tile.docked) {
    return;
  }
  if (!pastWindows.has(tile.container)) {
    pastWindows.add(tile.container);
    return;
  }
  const size = matchBufferSize(tile.fullCommand) ?? [450, 300];
  const buffer = tile.frame.closest(`.${C.Window.window}`);
  if (!buffer) {
    return;
  }
  const body = await $(buffer, C.Window.body);
  const width = parseInt(body.style.width.replace('px', ''), 10);
  const height = parseInt(body.style.height.replace('px', ''), 10);
  setBufferSize(tile.id, Math.max(size[0], width), Math.max(size[1], height));
}
function init() {
  tiles.observeAll(onTileReady);
}
features.add(import.meta.url, init, 'Automatically resizes the buffer size on command change.');
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0by1yZXNpemUtYnVmZmVycy5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2ZlYXR1cmVzL2Jhc2ljL2F1dG8tcmVzaXplLWJ1ZmZlcnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbWF0Y2hCdWZmZXJTaXplIH0gZnJvbSAnQHNyYy9pbmZyYXN0cnVjdHVyZS9wcnVuLXVpL2J1ZmZlci1zaXplcyc7XG5pbXBvcnQgeyBzZXRCdWZmZXJTaXplIH0gZnJvbSAnQHNyYy9pbmZyYXN0cnVjdHVyZS9wcnVuLXVpL2J1ZmZlcnMnO1xuXG5jb25zdCBwYXN0V2luZG93czogV2Vha1NldDxFbGVtZW50PiA9IG5ldyBXZWFrU2V0KCk7XG5cbmFzeW5jIGZ1bmN0aW9uIG9uVGlsZVJlYWR5KHRpbGU6IFBydW5UaWxlKSB7XG4gIGlmICh0aWxlLmRvY2tlZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmICghcGFzdFdpbmRvd3MuaGFzKHRpbGUuY29udGFpbmVyKSkge1xuICAgIC8vIFNraXAgdGhlIGZpcnN0IHRpbGUgYWN0aXZhdGlvbiwgYXMgdGhlIG1haW4gdGlsZXMudHMgYWRqdXN0cyB0aGUgc2l6ZSBpdHNlbGYuXG4gICAgcGFzdFdpbmRvd3MuYWRkKHRpbGUuY29udGFpbmVyKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBzaXplID0gbWF0Y2hCdWZmZXJTaXplKHRpbGUuZnVsbENvbW1hbmQpID8/IFs0NTAsIDMwMF07XG4gIGNvbnN0IGJ1ZmZlciA9IHRpbGUuZnJhbWUuY2xvc2VzdChgLiR7Qy5XaW5kb3cud2luZG93fWApO1xuICBpZiAoIWJ1ZmZlcikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGJvZHkgPSBhd2FpdCAkKGJ1ZmZlciwgQy5XaW5kb3cuYm9keSk7XG4gIGNvbnN0IHdpZHRoID0gcGFyc2VJbnQoYm9keS5zdHlsZS53aWR0aC5yZXBsYWNlKCdweCcsICcnKSwgMTApO1xuICBjb25zdCBoZWlnaHQgPSBwYXJzZUludChib2R5LnN0eWxlLmhlaWdodC5yZXBsYWNlKCdweCcsICcnKSwgMTApO1xuICBzZXRCdWZmZXJTaXplKHRpbGUuaWQsIE1hdGgubWF4KHNpemVbMF0sIHdpZHRoKSwgTWF0aC5tYXgoc2l6ZVsxXSwgaGVpZ2h0KSk7XG59XG5cbmZ1bmN0aW9uIGluaXQoKSB7XG4gIHRpbGVzLm9ic2VydmVBbGwob25UaWxlUmVhZHkpO1xufVxuXG5mZWF0dXJlcy5hZGQoaW1wb3J0Lm1ldGEudXJsLCBpbml0LCAnQXV0b21hdGljYWxseSByZXNpemVzIHRoZSBidWZmZXIgc2l6ZSBvbiBjb21tYW5kIGNoYW5nZS4nKTtcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFHQSxNQUFBLGNBQUEsb0JBQUEsUUFBQTtBQUVBLGVBQUEsWUFBQSxNQUFBO0FBQ0UsTUFBQSxLQUFBLFFBQUE7QUFDRTtBQUFBLEVBQUE7QUFHRixNQUFBLENBQUEsWUFBQSxJQUFBLEtBQUEsU0FBQSxHQUFBO0FBRUUsZ0JBQUEsSUFBQSxLQUFBLFNBQUE7QUFDQTtBQUFBLEVBQUE7QUFHRixRQUFBLE9BQUEsZ0JBQUEsS0FBQSxXQUFBLEtBQUEsQ0FBQSxLQUFBLEdBQUE7QUFDQSxRQUFBLFNBQUEsS0FBQSxNQUFBLFFBQUEsSUFBQSxFQUFBLE9BQUEsTUFBQSxFQUFBO0FBQ0EsTUFBQSxDQUFBLFFBQUE7QUFDRTtBQUFBLEVBQUE7QUFHRixRQUFBLE9BQUEsTUFBQSxFQUFBLFFBQUEsRUFBQSxPQUFBLElBQUE7QUFDQSxRQUFBLFFBQUEsU0FBQSxLQUFBLE1BQUEsTUFBQSxRQUFBLE1BQUEsRUFBQSxHQUFBLEVBQUE7QUFDQSxRQUFBLFNBQUEsU0FBQSxLQUFBLE1BQUEsT0FBQSxRQUFBLE1BQUEsRUFBQSxHQUFBLEVBQUE7QUFDQSxnQkFBQSxLQUFBLElBQUEsS0FBQSxJQUFBLEtBQUEsQ0FBQSxHQUFBLEtBQUEsR0FBQSxLQUFBLElBQUEsS0FBQSxDQUFBLEdBQUEsTUFBQSxDQUFBO0FBQ0Y7QUFFQSxTQUFBLE9BQUE7QUFDRSxRQUFBLFdBQUEsV0FBQTtBQUNGO0FBRUEsU0FBQSxJQUFBLFlBQUEsS0FBQSxNQUFBLDBEQUFBOyJ9
