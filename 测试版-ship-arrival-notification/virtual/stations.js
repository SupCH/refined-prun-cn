import { createEntityStore } from './create-entity-store.js';
import { onApiMessage } from './api-messages.js';
import { createMapGetter } from './create-map-getter.js';
import { castArray } from './cast-array.js';
import { defaultStations } from './stations.default.js';
import { getEntityNaturalIdFromAddress } from './addresses.js';
import { isEmpty } from './is-empty.js';
const store = createEntityStore(x => x.id, { preserveOnConnectionOpen: true });
const state = store.state;
onApiMessage({
  CLIENT_CONNECTION_OPENED() {
    store.setAll(defaultStations);
    store.setFetched();
  },
  DATA_DATA(data) {
    if (isEmpty(data.path) || data.path[0] !== 'stations') {
      return;
    }
    store.setMany(castArray(data.body));
  },
});
const getByNaturalId = createMapGetter(state.all, x => getEntityNaturalIdFromAddress(x.address));
const getByName = createMapGetter(state.all, x => x.name);
const getNaturalIdFromName = name => getEntityNaturalIdFromAddress(getByName(name)?.address);
const stationsStore = {
  ...state,
  getByNaturalId,
  getByName,
  getNaturalIdFromName,
};
export { stationsStore };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdGlvbnMuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9pbmZyYXN0cnVjdHVyZS9wcnVuLWFwaS9kYXRhL3N0YXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUVudGl0eVN0b3JlIH0gZnJvbSAnQHNyYy9pbmZyYXN0cnVjdHVyZS9wcnVuLWFwaS9kYXRhL2NyZWF0ZS1lbnRpdHktc3RvcmUnO1xuaW1wb3J0IHsgb25BcGlNZXNzYWdlIH0gZnJvbSAnQHNyYy9pbmZyYXN0cnVjdHVyZS9wcnVuLWFwaS9kYXRhL2FwaS1tZXNzYWdlcyc7XG5pbXBvcnQgeyBjcmVhdGVNYXBHZXR0ZXIgfSBmcm9tICdAc3JjL2luZnJhc3RydWN0dXJlL3BydW4tYXBpL2RhdGEvY3JlYXRlLW1hcC1nZXR0ZXInO1xuaW1wb3J0IHsgY2FzdEFycmF5IH0gZnJvbSAnQHNyYy91dGlscy9jYXN0LWFycmF5JztcbmltcG9ydCB7IGlzRW1wdHkgfSBmcm9tICd0cy1leHRyYXMnO1xuaW1wb3J0IHsgZGVmYXVsdFN0YXRpb25zIH0gZnJvbSAnQHNyYy9pbmZyYXN0cnVjdHVyZS9wcnVuLWFwaS9kYXRhL3N0YXRpb25zLmRlZmF1bHQnO1xuaW1wb3J0IHsgZ2V0RW50aXR5TmF0dXJhbElkRnJvbUFkZHJlc3MgfSBmcm9tICdAc3JjL2luZnJhc3RydWN0dXJlL3BydW4tYXBpL2RhdGEvYWRkcmVzc2VzJztcblxuY29uc3Qgc3RvcmUgPSBjcmVhdGVFbnRpdHlTdG9yZTxQcnVuQXBpLlN0YXRpb24+KHggPT4geC5pZCwgeyBwcmVzZXJ2ZU9uQ29ubmVjdGlvbk9wZW46IHRydWUgfSk7XG5jb25zdCBzdGF0ZSA9IHN0b3JlLnN0YXRlO1xuXG5vbkFwaU1lc3NhZ2Uoe1xuICBDTElFTlRfQ09OTkVDVElPTl9PUEVORUQoKSB7XG4gICAgc3RvcmUuc2V0QWxsKGRlZmF1bHRTdGF0aW9ucyk7XG4gICAgc3RvcmUuc2V0RmV0Y2hlZCgpO1xuICB9LFxuICBEQVRBX0RBVEEoZGF0YTogeyBib2R5OiBBcnJheWFibGU8UHJ1bkFwaS5TdGF0aW9uPjsgcGF0aDogc3RyaW5nW10gfSkge1xuICAgIGlmIChpc0VtcHR5KGRhdGEucGF0aCkgfHwgZGF0YS5wYXRoWzBdICE9PSAnc3RhdGlvbnMnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHN0b3JlLnNldE1hbnkoY2FzdEFycmF5KGRhdGEuYm9keSkpO1xuICB9LFxufSk7XG5cbmNvbnN0IGdldEJ5TmF0dXJhbElkID0gY3JlYXRlTWFwR2V0dGVyKHN0YXRlLmFsbCwgeCA9PiBnZXRFbnRpdHlOYXR1cmFsSWRGcm9tQWRkcmVzcyh4LmFkZHJlc3MpISk7XG5cbmNvbnN0IGdldEJ5TmFtZSA9IGNyZWF0ZU1hcEdldHRlcihzdGF0ZS5hbGwsIHggPT4geC5uYW1lKTtcblxuY29uc3QgZ2V0TmF0dXJhbElkRnJvbU5hbWUgPSAobmFtZT86IHN0cmluZyB8IG51bGwpID0+XG4gIGdldEVudGl0eU5hdHVyYWxJZEZyb21BZGRyZXNzKGdldEJ5TmFtZShuYW1lKT8uYWRkcmVzcyk7XG5cbmV4cG9ydCBjb25zdCBzdGF0aW9uc1N0b3JlID0ge1xuICAuLi5zdGF0ZSxcbiAgZ2V0QnlOYXR1cmFsSWQsXG4gIGdldEJ5TmFtZSxcbiAgZ2V0TmF0dXJhbElkRnJvbU5hbWUsXG59O1xuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFRQSxNQUFNLFFBQVEsa0JBQW1DLENBQUEsTUFBSyxFQUFFLElBQUksRUFBRSwwQkFBMEIsTUFBTTtBQUM5RixNQUFNLFFBQVEsTUFBTTtBQUVwQixhQUFhO0FBQUEsRUFDWCwyQkFBMkI7QUFDekIsVUFBTSxPQUFPLGVBQWU7QUFDNUIsVUFBTSxXQUFBO0FBQUEsRUFDUjtBQUFBLEVBQ0EsVUFBVSxNQUE0RDtBQUNwRSxRQUFJLFFBQVEsS0FBSyxJQUFJLEtBQUssS0FBSyxLQUFLLENBQUMsTUFBTSxZQUFZO0FBQ3JEO0FBQUEsSUFDRjtBQUNBLFVBQU0sUUFBUSxVQUFVLEtBQUssSUFBSSxDQUFDO0FBQUEsRUFDcEM7QUFDRixDQUFDO0FBRUQsTUFBTSxpQkFBaUIsZ0JBQWdCLE1BQU0sS0FBSyxPQUFLLDhCQUE4QixFQUFFLE9BQU8sQ0FBRTtBQUVoRyxNQUFNLFlBQVksZ0JBQWdCLE1BQU0sS0FBSyxDQUFBLE1BQUssRUFBRSxJQUFJO0FBRXhELE1BQU0sdUJBQXVCLENBQUMsU0FDNUIsOEJBQThCLFVBQVUsSUFBSSxHQUFHLE9BQU87QUFFakQsTUFBTSxnQkFBZ0I7QUFBQSxFQUMzQixHQUFHO0FBQUEsRUFDSDtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQ0Y7In0=
