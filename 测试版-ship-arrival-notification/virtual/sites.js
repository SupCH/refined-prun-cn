import { getEntityNaturalIdFromAddress, getEntityNameFromAddress } from './addresses.js';
import { createEntityStore } from './create-entity-store.js';
import { onApiMessage } from './api-messages.js';
import { createMapGetter } from './create-map-getter.js';
const store = createEntityStore(x => x.siteId);
const state = store.state;
onApiMessage({
  SITE_SITES(data) {
    store.setAll(data.sites);
    store.setFetched();
  },
  SITE_SITE(data) {
    store.setOne(data);
  },
  SITE_PLATFORM_BUILT(data) {
    const site = state.getById(data.siteId);
    if (site !== void 0 && !site.platforms.some(x => x.id === data.id)) {
      store.setOne({
        ...site,
        platforms: [...site.platforms, data],
      });
    }
  },
  SITE_PLATFORM_UPDATED(data) {
    const site = state.getById(data.siteId);
    if (site !== void 0) {
      store.setOne({
        ...site,
        platforms: site.platforms.map(x => (x.id === data.id ? { ...x, ...data } : x)),
      });
    }
  },
  SITE_PLATFORM_REMOVED(data) {
    const site = state.getById(data.siteId);
    if (site !== void 0) {
      store.setOne({
        ...site,
        platforms: site.platforms.filter(x => x.id !== data.platformId),
      });
    }
  },
});
const getByShortId = createMapGetter(state.all, x => x.siteId.substring(0, 8));
const getById = value => state.getById(value) ?? getByShortId(value);
const getByPlanetNaturalId = createMapGetter(state.all, x =>
  getEntityNaturalIdFromAddress(x.address),
);
const getByPlanetName = createMapGetter(state.all, x => getEntityNameFromAddress(x.address));
const getByPlanetNaturalIdOrName = value => getByPlanetNaturalId(value) ?? getByPlanetName(value);
const getBuildingLastRepair = building =>
  building.lastRepair?.timestamp ?? building.creationTime.timestamp;
const sitesStore = {
  ...state,
  getById,
  getByPlanetNaturalId,
  getByPlanetName,
  getByPlanetNaturalIdOrName,
};
export { getBuildingLastRepair, sitesStore };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2l0ZXMuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9pbmZyYXN0cnVjdHVyZS9wcnVuLWFwaS9kYXRhL3NpdGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIGdldEVudGl0eU5hbWVGcm9tQWRkcmVzcyxcbiAgZ2V0RW50aXR5TmF0dXJhbElkRnJvbUFkZHJlc3MsXG59IGZyb20gJ0BzcmMvaW5mcmFzdHJ1Y3R1cmUvcHJ1bi1hcGkvZGF0YS9hZGRyZXNzZXMnO1xuaW1wb3J0IHsgY3JlYXRlRW50aXR5U3RvcmUgfSBmcm9tICdAc3JjL2luZnJhc3RydWN0dXJlL3BydW4tYXBpL2RhdGEvY3JlYXRlLWVudGl0eS1zdG9yZSc7XG5pbXBvcnQgeyBvbkFwaU1lc3NhZ2UgfSBmcm9tICdAc3JjL2luZnJhc3RydWN0dXJlL3BydW4tYXBpL2RhdGEvYXBpLW1lc3NhZ2VzJztcbmltcG9ydCB7IGNyZWF0ZU1hcEdldHRlciB9IGZyb20gJ0BzcmMvaW5mcmFzdHJ1Y3R1cmUvcHJ1bi1hcGkvZGF0YS9jcmVhdGUtbWFwLWdldHRlcic7XG5cbmNvbnN0IHN0b3JlID0gY3JlYXRlRW50aXR5U3RvcmU8UHJ1bkFwaS5TaXRlPih4ID0+IHguc2l0ZUlkKTtcbmNvbnN0IHN0YXRlID0gc3RvcmUuc3RhdGU7XG5cbm9uQXBpTWVzc2FnZSh7XG4gIFNJVEVfU0lURVMoZGF0YTogeyBzaXRlczogUHJ1bkFwaS5TaXRlW10gfSkge1xuICAgIHN0b3JlLnNldEFsbChkYXRhLnNpdGVzKTtcbiAgICBzdG9yZS5zZXRGZXRjaGVkKCk7XG4gIH0sXG4gIFNJVEVfU0lURShkYXRhOiBQcnVuQXBpLlNpdGUpIHtcbiAgICBzdG9yZS5zZXRPbmUoZGF0YSk7XG4gIH0sXG4gIFNJVEVfUExBVEZPUk1fQlVJTFQoZGF0YTogUHJ1bkFwaS5QbGF0Zm9ybSkge1xuICAgIGNvbnN0IHNpdGUgPSBzdGF0ZS5nZXRCeUlkKGRhdGEuc2l0ZUlkKTtcbiAgICBpZiAoc2l0ZSAhPT0gdW5kZWZpbmVkICYmICFzaXRlLnBsYXRmb3Jtcy5zb21lKHggPT4geC5pZCA9PT0gZGF0YS5pZCkpIHtcbiAgICAgIHN0b3JlLnNldE9uZSh7XG4gICAgICAgIC4uLnNpdGUsXG4gICAgICAgIHBsYXRmb3JtczogWy4uLnNpdGUucGxhdGZvcm1zLCBkYXRhXSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcbiAgU0lURV9QTEFURk9STV9VUERBVEVEKGRhdGE6IFBydW5BcGkuUGxhdGZvcm0pIHtcbiAgICBjb25zdCBzaXRlID0gc3RhdGUuZ2V0QnlJZChkYXRhLnNpdGVJZCk7XG4gICAgaWYgKHNpdGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgc3RvcmUuc2V0T25lKHtcbiAgICAgICAgLi4uc2l0ZSxcbiAgICAgICAgcGxhdGZvcm1zOiBzaXRlLnBsYXRmb3Jtcy5tYXAoeCA9PiAoeC5pZCA9PT0gZGF0YS5pZCA/IHsgLi4ueCwgLi4uZGF0YSB9IDogeCkpLFxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuICBTSVRFX1BMQVRGT1JNX1JFTU9WRUQoZGF0YTogeyBzaXRlSWQ6IHN0cmluZzsgcGxhdGZvcm1JZDogc3RyaW5nIH0pIHtcbiAgICBjb25zdCBzaXRlID0gc3RhdGUuZ2V0QnlJZChkYXRhLnNpdGVJZCk7XG4gICAgaWYgKHNpdGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgc3RvcmUuc2V0T25lKHtcbiAgICAgICAgLi4uc2l0ZSxcbiAgICAgICAgcGxhdGZvcm1zOiBzaXRlLnBsYXRmb3Jtcy5maWx0ZXIoeCA9PiB4LmlkICE9PSBkYXRhLnBsYXRmb3JtSWQpLFxuICAgICAgfSk7XG4gICAgfVxuICB9LFxufSk7XG5cbmNvbnN0IGdldEJ5U2hvcnRJZCA9IGNyZWF0ZU1hcEdldHRlcihzdGF0ZS5hbGwsIHggPT4geC5zaXRlSWQuc3Vic3RyaW5nKDAsIDgpKTtcblxuY29uc3QgZ2V0QnlJZCA9ICh2YWx1ZT86IHN0cmluZyB8IG51bGwpID0+IHN0YXRlLmdldEJ5SWQodmFsdWUpID8/IGdldEJ5U2hvcnRJZCh2YWx1ZSk7XG5cbmNvbnN0IGdldEJ5UGxhbmV0TmF0dXJhbElkID0gY3JlYXRlTWFwR2V0dGVyKFxuICBzdGF0ZS5hbGwsXG4gIHggPT4gZ2V0RW50aXR5TmF0dXJhbElkRnJvbUFkZHJlc3MoeC5hZGRyZXNzKSEsXG4pO1xuXG5jb25zdCBnZXRCeVBsYW5ldE5hbWUgPSBjcmVhdGVNYXBHZXR0ZXIoc3RhdGUuYWxsLCB4ID0+IGdldEVudGl0eU5hbWVGcm9tQWRkcmVzcyh4LmFkZHJlc3MpISk7XG5cbmNvbnN0IGdldEJ5UGxhbmV0TmF0dXJhbElkT3JOYW1lID0gKHZhbHVlPzogc3RyaW5nIHwgbnVsbCkgPT5cbiAgZ2V0QnlQbGFuZXROYXR1cmFsSWQodmFsdWUpID8/IGdldEJ5UGxhbmV0TmFtZSh2YWx1ZSk7XG5cbmV4cG9ydCBjb25zdCBnZXRCdWlsZGluZ0xhc3RSZXBhaXIgPSAoYnVpbGRpbmc6IFBydW5BcGkuUGxhdGZvcm0pID0+XG4gIGJ1aWxkaW5nLmxhc3RSZXBhaXI/LnRpbWVzdGFtcCA/PyBidWlsZGluZy5jcmVhdGlvblRpbWUudGltZXN0YW1wO1xuXG5leHBvcnQgY29uc3Qgc2l0ZXNTdG9yZSA9IHtcbiAgLi4uc3RhdGUsXG4gIGdldEJ5SWQsXG4gIGdldEJ5UGxhbmV0TmF0dXJhbElkLFxuICBnZXRCeVBsYW5ldE5hbWUsXG4gIGdldEJ5UGxhbmV0TmF0dXJhbElkT3JOYW1lLFxufTtcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBUUEsTUFBTSxRQUFRLGtCQUFnQyxDQUFBLE1BQUssRUFBRSxNQUFNO0FBQzNELE1BQU0sUUFBUSxNQUFNO0FBRXBCLGFBQWE7QUFBQSxFQUNYLFdBQVcsTUFBaUM7QUFDMUMsVUFBTSxPQUFPLEtBQUssS0FBSztBQUN2QixVQUFNLFdBQUE7QUFBQSxFQUNSO0FBQUEsRUFDQSxVQUFVLE1BQW9CO0FBQzVCLFVBQU0sT0FBTyxJQUFJO0FBQUEsRUFDbkI7QUFBQSxFQUNBLG9CQUFvQixNQUF3QjtBQUMxQyxVQUFNLE9BQU8sTUFBTSxRQUFRLEtBQUssTUFBTTtBQUN0QyxRQUFJLFNBQVMsVUFBYSxDQUFDLEtBQUssVUFBVSxLQUFLLENBQUEsTUFBSyxFQUFFLE9BQU8sS0FBSyxFQUFFLEdBQUc7QUFDckUsWUFBTSxPQUFPO0FBQUEsUUFDWCxHQUFHO0FBQUEsUUFDSCxXQUFXLENBQUMsR0FBRyxLQUFLLFdBQVcsSUFBSTtBQUFBLE1BQUEsQ0FDcEM7QUFBQSxJQUNIO0FBQUEsRUFDRjtBQUFBLEVBQ0Esc0JBQXNCLE1BQXdCO0FBQzVDLFVBQU0sT0FBTyxNQUFNLFFBQVEsS0FBSyxNQUFNO0FBQ3RDLFFBQUksU0FBUyxRQUFXO0FBQ3RCLFlBQU0sT0FBTztBQUFBLFFBQ1gsR0FBRztBQUFBLFFBQ0gsV0FBVyxLQUFLLFVBQVUsSUFBSSxPQUFNLEVBQUUsT0FBTyxLQUFLLEtBQUssRUFBRSxHQUFHLEdBQUcsR0FBRyxLQUFBLElBQVMsQ0FBRTtBQUFBLE1BQUEsQ0FDOUU7QUFBQSxJQUNIO0FBQUEsRUFDRjtBQUFBLEVBQ0Esc0JBQXNCLE1BQThDO0FBQ2xFLFVBQU0sT0FBTyxNQUFNLFFBQVEsS0FBSyxNQUFNO0FBQ3RDLFFBQUksU0FBUyxRQUFXO0FBQ3RCLFlBQU0sT0FBTztBQUFBLFFBQ1gsR0FBRztBQUFBLFFBQ0gsV0FBVyxLQUFLLFVBQVUsT0FBTyxPQUFLLEVBQUUsT0FBTyxLQUFLLFVBQVU7QUFBQSxNQUFBLENBQy9EO0FBQUEsSUFDSDtBQUFBLEVBQ0Y7QUFDRixDQUFDO0FBRUQsTUFBTSxlQUFlLGdCQUFnQixNQUFNLEtBQUssQ0FBQSxNQUFLLEVBQUUsT0FBTyxVQUFVLEdBQUcsQ0FBQyxDQUFDO0FBRTdFLE1BQU0sVUFBVSxDQUFDLFVBQTBCLE1BQU0sUUFBUSxLQUFLLEtBQUssYUFBYSxLQUFLO0FBRXJGLE1BQU0sdUJBQXVCO0FBQUEsRUFDM0IsTUFBTTtBQUFBLEVBQ04sQ0FBQSxNQUFLLDhCQUE4QixFQUFFLE9BQU87QUFDOUM7QUFFQSxNQUFNLGtCQUFrQixnQkFBZ0IsTUFBTSxLQUFLLE9BQUsseUJBQXlCLEVBQUUsT0FBTyxDQUFFO0FBRTVGLE1BQU0sNkJBQTZCLENBQUMsVUFDbEMscUJBQXFCLEtBQUssS0FBSyxnQkFBZ0IsS0FBSztBQUUvQyxNQUFNLHdCQUF3QixDQUFDLGFBQ3BDLFNBQVMsWUFBWSxhQUFhLFNBQVMsYUFBYTtBQUVuRCxNQUFNLGFBQWE7QUFBQSxFQUN4QixHQUFHO0FBQUEsRUFDSDtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUNGOyJ9
