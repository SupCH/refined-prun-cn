import { onApiMessage } from './api-messages.js';
import { shallowReactive, ref } from './reactivity.esm-bundler.js';
import { computed } from './runtime-core.esm-bundler.js';
function createEntityStore(selectId, options) {
  selectId = selectId ?? (model => model.id);
  let entities = shallowReactive({});
  const fetched = ref(false);
  if (!options?.preserveOnConnectionOpen) {
    onApiMessage({
      CLIENT_CONNECTION_OPENED() {
        fetched.value = false;
        entities = shallowReactive({});
      },
    });
  }
  return {
    state: {
      fetched,
      entities: computed(() => {
        return fetched.value ? entities : void 0;
      }),
      all: computed(() => (fetched.value ? Object.values(entities) : void 0)),
      getById: id => (fetched.value && id ? entities[id] : void 0),
    },
    setAll(items) {
      for (const key in entities) {
        delete entities[key];
      }
      for (const item of items) {
        entities[selectId(item)] = item;
      }
    },
    setOne(item) {
      entities[selectId(item)] = item;
    },
    setMany(items) {
      for (const item of items) {
        entities[selectId(item)] = item;
      }
    },
    addOne(item) {
      const id = selectId(item);
      if (!entities[id]) {
        entities[id] = item;
      }
    },
    updateOne(item) {
      const id = selectId(item);
      if (entities[id]) {
        entities[id] = {
          ...entities[id],
          ...item,
        };
      }
    },
    removeOne(id) {
      delete entities[id];
    },
    setFetched() {
      fetched.value = true;
    },
  };
}
export { createEntityStore };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlLWVudGl0eS1zdG9yZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2luZnJhc3RydWN0dXJlL3BydW4tYXBpL2RhdGEvY3JlYXRlLWVudGl0eS1zdG9yZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBvbkFwaU1lc3NhZ2UgfSBmcm9tICdAc3JjL2luZnJhc3RydWN0dXJlL3BydW4tYXBpL2RhdGEvYXBpLW1lc3NhZ2VzJztcblxudHlwZSBFbnRpdHlJZCA9IG51bWJlciB8IHN0cmluZztcbnR5cGUgSWRTZWxlY3RvcjxULCBJZCBleHRlbmRzIEVudGl0eUlkPiA9IChtb2RlbDogVCkgPT4gSWQ7XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVFbnRpdHlTdG9yZTxUPihcbiAgc2VsZWN0SWQ/OiBJZFNlbGVjdG9yPFQsIHN0cmluZz4sXG4gIG9wdGlvbnM/OiB7XG4gICAgcHJlc2VydmVPbkNvbm5lY3Rpb25PcGVuPzogYm9vbGVhbjtcbiAgfSxcbikge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICBzZWxlY3RJZCA9IHNlbGVjdElkID8/ICgobW9kZWw6IGFueSkgPT4gbW9kZWwuaWQpO1xuICBsZXQgZW50aXRpZXMgPSBzaGFsbG93UmVhY3RpdmUoe30gYXMgUmVjb3JkPHN0cmluZywgVD4pO1xuICBjb25zdCBmZXRjaGVkID0gcmVmKGZhbHNlKTtcblxuICBpZiAoIW9wdGlvbnM/LnByZXNlcnZlT25Db25uZWN0aW9uT3Blbikge1xuICAgIG9uQXBpTWVzc2FnZSh7XG4gICAgICBDTElFTlRfQ09OTkVDVElPTl9PUEVORUQoKSB7XG4gICAgICAgIGZldGNoZWQudmFsdWUgPSBmYWxzZTtcbiAgICAgICAgZW50aXRpZXMgPSBzaGFsbG93UmVhY3RpdmUoe30gYXMgUmVjb3JkPHN0cmluZywgVD4pO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgc3RhdGU6IHtcbiAgICAgIGZldGNoZWQsXG4gICAgICBlbnRpdGllczogY29tcHV0ZWQoKCkgPT4ge1xuICAgICAgICByZXR1cm4gZmV0Y2hlZC52YWx1ZSA/IGVudGl0aWVzIDogdW5kZWZpbmVkO1xuICAgICAgfSksXG4gICAgICBhbGw6IGNvbXB1dGVkKCgpID0+IChmZXRjaGVkLnZhbHVlID8gT2JqZWN0LnZhbHVlcyhlbnRpdGllcykgOiB1bmRlZmluZWQpKSxcbiAgICAgIGdldEJ5SWQ6IChpZD86IHN0cmluZyB8IG51bGwpID0+IChmZXRjaGVkLnZhbHVlICYmIGlkID8gZW50aXRpZXNbaWRdIDogdW5kZWZpbmVkKSxcbiAgICB9LFxuICAgIHNldEFsbChpdGVtczogVFtdKSB7XG4gICAgICBmb3IgKGNvbnN0IGtleSBpbiBlbnRpdGllcykge1xuICAgICAgICBkZWxldGUgZW50aXRpZXNba2V5XTtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykge1xuICAgICAgICBlbnRpdGllc1tzZWxlY3RJZChpdGVtKV0gPSBpdGVtO1xuICAgICAgfVxuICAgIH0sXG4gICAgc2V0T25lKGl0ZW06IFQpIHtcbiAgICAgIGVudGl0aWVzW3NlbGVjdElkKGl0ZW0pXSA9IGl0ZW07XG4gICAgfSxcbiAgICBzZXRNYW55KGl0ZW1zOiBUW10pIHtcbiAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykge1xuICAgICAgICBlbnRpdGllc1tzZWxlY3RJZChpdGVtKV0gPSBpdGVtO1xuICAgICAgfVxuICAgIH0sXG4gICAgYWRkT25lKGl0ZW06IFQpIHtcbiAgICAgIGNvbnN0IGlkID0gc2VsZWN0SWQoaXRlbSk7XG4gICAgICBpZiAoIWVudGl0aWVzW2lkXSkge1xuICAgICAgICBlbnRpdGllc1tpZF0gPSBpdGVtO1xuICAgICAgfVxuICAgIH0sXG4gICAgdXBkYXRlT25lKGl0ZW06IFQpIHtcbiAgICAgIGNvbnN0IGlkID0gc2VsZWN0SWQoaXRlbSk7XG4gICAgICBpZiAoZW50aXRpZXNbaWRdKSB7XG4gICAgICAgIGVudGl0aWVzW2lkXSA9IHtcbiAgICAgICAgICAuLi5lbnRpdGllc1tpZF0sXG4gICAgICAgICAgLi4uaXRlbSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHJlbW92ZU9uZShpZDogc3RyaW5nKSB7XG4gICAgICBkZWxldGUgZW50aXRpZXNbaWRdO1xuICAgIH0sXG4gICAgc2V0RmV0Y2hlZCgpIHtcbiAgICAgIGZldGNoZWQudmFsdWUgPSB0cnVlO1xuICAgIH0sXG4gIH07XG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBS08sU0FBQSxrQkFBQSxVQUFBLFNBQUE7QUFPTCxhQUFBLGFBQUEsQ0FBQSxVQUFBLE1BQUE7QUFDQSxNQUFBLFdBQUEsZ0JBQUEsRUFBQTtBQUNBLFFBQUEsVUFBQSxJQUFBLEtBQUE7QUFFQSxNQUFBLENBQUEsU0FBQSwwQkFBQTtBQUNFLGlCQUFBO0FBQUEsTUFBYSwyQkFBQTtBQUVULGdCQUFBLFFBQUE7QUFDQSxtQkFBQSxnQkFBQSxFQUFBO0FBQUEsTUFBa0Q7QUFBQSxJQUNwRCxDQUFBO0FBQUEsRUFDRDtBQUdILFNBQUE7QUFBQSxJQUFPLE9BQUE7QUFBQSxNQUNFO0FBQUEsTUFDTCxVQUFBLFNBQUEsTUFBQTtBQUVFLGVBQUEsUUFBQSxRQUFBLFdBQUE7QUFBQSxNQUFrQyxDQUFBO0FBQUEsTUFDbkMsS0FBQSxTQUFBLE1BQUEsUUFBQSxRQUFBLE9BQUEsT0FBQSxRQUFBLElBQUEsTUFBQTtBQUFBLE1BQ3dFLFNBQUEsQ0FBQSxPQUFBLFFBQUEsU0FBQSxLQUFBLFNBQUEsRUFBQSxJQUFBO0FBQUEsSUFDRjtBQUFBLElBQ3pFLE9BQUEsT0FBQTtBQUVFLGlCQUFBLE9BQUEsVUFBQTtBQUNFLGVBQUEsU0FBQSxHQUFBO0FBQUEsTUFBbUI7QUFFckIsaUJBQUEsUUFBQSxPQUFBO0FBQ0UsaUJBQUEsU0FBQSxJQUFBLENBQUEsSUFBQTtBQUFBLE1BQTJCO0FBQUEsSUFDN0I7QUFBQSxJQUNGLE9BQUEsTUFBQTtBQUVFLGVBQUEsU0FBQSxJQUFBLENBQUEsSUFBQTtBQUFBLElBQTJCO0FBQUEsSUFDN0IsUUFBQSxPQUFBO0FBRUUsaUJBQUEsUUFBQSxPQUFBO0FBQ0UsaUJBQUEsU0FBQSxJQUFBLENBQUEsSUFBQTtBQUFBLE1BQTJCO0FBQUEsSUFDN0I7QUFBQSxJQUNGLE9BQUEsTUFBQTtBQUVFLFlBQUEsS0FBQSxTQUFBLElBQUE7QUFDQSxVQUFBLENBQUEsU0FBQSxFQUFBLEdBQUE7QUFDRSxpQkFBQSxFQUFBLElBQUE7QUFBQSxNQUFlO0FBQUEsSUFDakI7QUFBQSxJQUNGLFVBQUEsTUFBQTtBQUVFLFlBQUEsS0FBQSxTQUFBLElBQUE7QUFDQSxVQUFBLFNBQUEsRUFBQSxHQUFBO0FBQ0UsaUJBQUEsRUFBQSxJQUFBO0FBQUEsVUFBZSxHQUFBLFNBQUEsRUFBQTtBQUFBLFVBQ0MsR0FBQTtBQUFBLFFBQ1g7QUFBQSxNQUNMO0FBQUEsSUFDRjtBQUFBLElBQ0YsVUFBQSxJQUFBO0FBRUUsYUFBQSxTQUFBLEVBQUE7QUFBQSxJQUFrQjtBQUFBLElBQ3BCLGFBQUE7QUFFRSxjQUFBLFFBQUE7QUFBQSxJQUFnQjtBQUFBLEVBQ2xCO0FBRUo7In0=
