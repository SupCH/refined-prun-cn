import { shallowRef } from './reactivity.esm-bundler.js';
const storageKey = 'refined-prun';
const maxBackups = 5;
const hoursBetweenBackups = 24;
const refBackups = shallowRef(loadBackups());
function getUserDataBackups() {
  return refBackups.value;
}
function loadBackups() {
  try {
    const json = localStorage.getItem(storageKey);
    if (!json) {
      return [];
    }
    const backups = JSON.parse(json);
    if (!backups?.backups) {
      return [];
    }
    return backups.backups;
  } catch {
    return [];
  }
}
function saveBackups(backups) {
  localStorage.setItem(storageKey, JSON.stringify({ backups }));
  refBackups.value = [...backups];
}
function backupUserData(data) {
  const backups = getUserDataBackups();
  const hasRecentBackup =
    backups.length > 0 && backups[0].timestamp > Date.now() - hoursBetweenBackups * 36e5;
  if (hasRecentBackup) {
    return;
  }
  backups.unshift({
    data,
    timestamp: Date.now(),
  });
  while (backups.length > maxBackups) {
    backups.pop();
  }
  saveBackups(backups);
}
function deleteUserDataBackup(backup) {
  const backups = getUserDataBackups().filter(x => x !== backup);
  saveBackups(backups);
}
export { backupUserData, deleteUserDataBackup, getUserDataBackups };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci1kYXRhLWJhY2t1cC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2luZnJhc3RydWN0dXJlL3N0b3JhZ2UvdXNlci1kYXRhLWJhY2t1cC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55ICovXG5cbmNvbnN0IHN0b3JhZ2VLZXkgPSAncmVmaW5lZC1wcnVuJztcbmNvbnN0IG1heEJhY2t1cHMgPSA1O1xuY29uc3QgaG91cnNCZXR3ZWVuQmFja3VwcyA9IDI0O1xuXG5leHBvcnQgaW50ZXJmYWNlIFVzZXJEYXRhQmFja3VwIHtcbiAgZGF0YTogYW55O1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIEJhY2t1cHMge1xuICBiYWNrdXBzOiBVc2VyRGF0YUJhY2t1cFtdO1xufVxuXG5jb25zdCByZWZCYWNrdXBzID0gc2hhbGxvd1JlZjxVc2VyRGF0YUJhY2t1cFtdPihsb2FkQmFja3VwcygpKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldFVzZXJEYXRhQmFja3VwcygpIHtcbiAgcmV0dXJuIHJlZkJhY2t1cHMudmFsdWU7XG59XG5cbmZ1bmN0aW9uIGxvYWRCYWNrdXBzKCkge1xuICB0cnkge1xuICAgIGNvbnN0IGpzb24gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShzdG9yYWdlS2V5KTtcbiAgICBpZiAoIWpzb24pIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgY29uc3QgYmFja3VwcyA9IEpTT04ucGFyc2UoanNvbik7XG4gICAgaWYgKCFiYWNrdXBzPy5iYWNrdXBzKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIHJldHVybiAoYmFja3VwcyBhcyBCYWNrdXBzKS5iYWNrdXBzO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gW107XG4gIH1cbn1cblxuZnVuY3Rpb24gc2F2ZUJhY2t1cHMoYmFja3VwczogVXNlckRhdGFCYWNrdXBbXSkge1xuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShzdG9yYWdlS2V5LCBKU09OLnN0cmluZ2lmeSh7IGJhY2t1cHMgfSkpO1xuICByZWZCYWNrdXBzLnZhbHVlID0gWy4uLmJhY2t1cHNdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYmFja3VwVXNlckRhdGEoZGF0YTogYW55KSB7XG4gIGNvbnN0IGJhY2t1cHMgPSBnZXRVc2VyRGF0YUJhY2t1cHMoKTtcbiAgY29uc3QgaGFzUmVjZW50QmFja3VwID1cbiAgICBiYWNrdXBzLmxlbmd0aCA+IDAgJiYgYmFja3Vwc1swXS50aW1lc3RhbXAgPiBEYXRlLm5vdygpIC0gaG91cnNCZXR3ZWVuQmFja3VwcyAqIDM2MDAwMDA7XG4gIGlmIChoYXNSZWNlbnRCYWNrdXApIHtcbiAgICByZXR1cm47XG4gIH1cbiAgYmFja3Vwcy51bnNoaWZ0KHtcbiAgICBkYXRhLFxuICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgfSk7XG4gIHdoaWxlIChiYWNrdXBzLmxlbmd0aCA+IG1heEJhY2t1cHMpIHtcbiAgICBiYWNrdXBzLnBvcCgpO1xuICB9XG4gIHNhdmVCYWNrdXBzKGJhY2t1cHMpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZGVsZXRlVXNlckRhdGFCYWNrdXAoYmFja3VwOiBVc2VyRGF0YUJhY2t1cCkge1xuICBjb25zdCBiYWNrdXBzID0gZ2V0VXNlckRhdGFCYWNrdXBzKCkuZmlsdGVyKHggPT4geCAhPT0gYmFja3VwKTtcbiAgc2F2ZUJhY2t1cHMoYmFja3Vwcyk7XG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUVBLE1BQUEsYUFBQTtBQUNBLE1BQUEsYUFBQTtBQUNBLE1BQUEsc0JBQUE7QUFXQSxNQUFBLGFBQUEsV0FBQSxhQUFBO0FBRU8sU0FBQSxxQkFBQTtBQUNMLFNBQUEsV0FBQTtBQUNGO0FBRUEsU0FBQSxjQUFBO0FBQ0UsTUFBQTtBQUNFLFVBQUEsT0FBQSxhQUFBLFFBQUEsVUFBQTtBQUNBLFFBQUEsQ0FBQSxNQUFBO0FBQ0UsYUFBQSxDQUFBO0FBQUEsSUFBUTtBQUVWLFVBQUEsVUFBQSxLQUFBLE1BQUEsSUFBQTtBQUNBLFFBQUEsQ0FBQSxTQUFBLFNBQUE7QUFDRSxhQUFBLENBQUE7QUFBQSxJQUFRO0FBRVYsV0FBQSxRQUFBO0FBQUEsRUFBNEIsUUFBQTtBQUU1QixXQUFBLENBQUE7QUFBQSxFQUFRO0FBRVo7QUFFQSxTQUFBLFlBQUEsU0FBQTtBQUNFLGVBQUEsUUFBQSxZQUFBLEtBQUEsVUFBQSxFQUFBLFFBQUEsQ0FBQSxDQUFBO0FBQ0EsYUFBQSxRQUFBLENBQUEsR0FBQSxPQUFBO0FBQ0Y7QUFFTyxTQUFBLGVBQUEsTUFBQTtBQUNMLFFBQUEsVUFBQSxtQkFBQTtBQUNBLFFBQUEsa0JBQUEsUUFBQSxTQUFBLEtBQUEsUUFBQSxDQUFBLEVBQUEsWUFBQSxLQUFBLElBQUEsSUFBQSxzQkFBQTtBQUVBLE1BQUEsaUJBQUE7QUFDRTtBQUFBLEVBQUE7QUFFRixVQUFBLFFBQUE7QUFBQSxJQUFnQjtBQUFBLElBQ2QsV0FBQSxLQUFBLElBQUE7QUFBQSxFQUNvQixDQUFBO0FBRXRCLFNBQUEsUUFBQSxTQUFBLFlBQUE7QUFDRSxZQUFBLElBQUE7QUFBQSxFQUFZO0FBRWQsY0FBQSxPQUFBO0FBQ0Y7QUFFTyxTQUFBLHFCQUFBLFFBQUE7QUFDTCxRQUFBLFVBQUEscUJBQUEsT0FBQSxDQUFBLE1BQUEsTUFBQSxNQUFBO0FBQ0EsY0FBQSxPQUFBO0FBQ0Y7In0=
