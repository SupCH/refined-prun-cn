import { onApiMessage } from './api-messages.js';
import { createEntityStore } from './create-entity-store.js';
import { shallowReactive, ref } from './reactivity.esm-bundler.js';
import { computed } from './runtime-core.esm-bundler.js';
const store = createEntityStore();
const state = store.state;
const removed = shallowReactive([]);
onApiMessage({
  UI_DATA(data) {
    store.setAll(data.screens);
    removed.length = 0;
    removed.push(...data.removedScreens);
    store.setFetched();
  },
  UI_SCREENS_ADD(data) {
    store.addOne(data);
  },
  UI_SCREENS_RENAME(data) {
    const screen = state.getById(data.id);
    if (screen !== void 0) {
      store.setOne({
        ...screen,
        name: data.name,
      });
    }
  },
  UI_SCREENS_DELETE(data) {
    const screen = state.getById(data.id);
    if (!screen) {
      return;
    }
    store.removeOne(data.id);
    removed.unshift(screen);
  },
  UI_SCREENS_UNDELETE() {
    const screen = removed.shift();
    if (!screen) {
      return;
    }
    store.addOne(screen);
  },
});
const screenHash = ref(void 0);
const context = ref(void 0);
function updateCurrent() {
  screenHash.value = location.hash.match(/screen=([^&]*)/)?.[1];
  context.value = location.hash.match(/context=([^&]*)/)?.[1];
}
updateCurrent();
window.addEventListener('locationchange', updateCurrent);
window.addEventListener('hashchange', updateCurrent);
const sorted = computed(() =>
  state.all.value
    ?.filter(x => !x.hidden)
    .sort((a, b) => (a.name === b.name ? 0 : a.name < b.name ? -1 : 1)),
);
const current = computed(
  () => sorted.value?.find(x => x.id === screenHash.value) ?? sorted.value?.[0],
);
const screensStore = {
  ...state,
  sorted,
  current,
};
export { context, screenHash, screensStore };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyZWVucy5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2luZnJhc3RydWN0dXJlL3BydW4tYXBpL2RhdGEvc2NyZWVucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBvbkFwaU1lc3NhZ2UgfSBmcm9tICdAc3JjL2luZnJhc3RydWN0dXJlL3BydW4tYXBpL2RhdGEvYXBpLW1lc3NhZ2VzJztcbmltcG9ydCB7IGNyZWF0ZUVudGl0eVN0b3JlIH0gZnJvbSAnQHNyYy9pbmZyYXN0cnVjdHVyZS9wcnVuLWFwaS9kYXRhL2NyZWF0ZS1lbnRpdHktc3RvcmUnO1xuXG5jb25zdCBzdG9yZSA9IGNyZWF0ZUVudGl0eVN0b3JlPFBydW5BcGkuU2NyZWVuPigpO1xuY29uc3Qgc3RhdGUgPSBzdG9yZS5zdGF0ZTtcblxuY29uc3QgcmVtb3ZlZCA9IHNoYWxsb3dSZWFjdGl2ZShbXSBhcyBQcnVuQXBpLlNjcmVlbltdKTtcblxub25BcGlNZXNzYWdlKHtcbiAgVUlfREFUQShkYXRhOiBQcnVuQXBpLlVJRGF0YSkge1xuICAgIHN0b3JlLnNldEFsbChkYXRhLnNjcmVlbnMpO1xuICAgIHJlbW92ZWQubGVuZ3RoID0gMDtcbiAgICByZW1vdmVkLnB1c2goLi4uZGF0YS5yZW1vdmVkU2NyZWVucyk7XG4gICAgc3RvcmUuc2V0RmV0Y2hlZCgpO1xuICB9LFxuICBVSV9TQ1JFRU5TX0FERChkYXRhOiBQcnVuQXBpLlNjcmVlbikge1xuICAgIHN0b3JlLmFkZE9uZShkYXRhKTtcbiAgfSxcbiAgVUlfU0NSRUVOU19SRU5BTUUoZGF0YTogeyBpZDogc3RyaW5nOyBuYW1lOiBzdHJpbmcgfSkge1xuICAgIGNvbnN0IHNjcmVlbiA9IHN0YXRlLmdldEJ5SWQoZGF0YS5pZCk7XG4gICAgaWYgKHNjcmVlbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBzdG9yZS5zZXRPbmUoe1xuICAgICAgICAuLi5zY3JlZW4sXG4gICAgICAgIG5hbWU6IGRhdGEubmFtZSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcbiAgVUlfU0NSRUVOU19ERUxFVEUoZGF0YTogeyBpZDogc3RyaW5nIH0pIHtcbiAgICBjb25zdCBzY3JlZW4gPSBzdGF0ZS5nZXRCeUlkKGRhdGEuaWQpO1xuICAgIGlmICghc2NyZWVuKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHN0b3JlLnJlbW92ZU9uZShkYXRhLmlkKTtcbiAgICByZW1vdmVkLnVuc2hpZnQoc2NyZWVuKTtcbiAgfSxcbiAgVUlfU0NSRUVOU19VTkRFTEVURSgpIHtcbiAgICBjb25zdCBzY3JlZW4gPSByZW1vdmVkLnNoaWZ0KCk7XG4gICAgaWYgKCFzY3JlZW4pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc3RvcmUuYWRkT25lKHNjcmVlbik7XG4gIH0sXG59KTtcblxuZXhwb3J0IGNvbnN0IHNjcmVlbkhhc2ggPSByZWYodW5kZWZpbmVkIGFzIHN0cmluZyB8IHVuZGVmaW5lZCk7XG5leHBvcnQgY29uc3QgY29udGV4dCA9IHJlZih1bmRlZmluZWQgYXMgc3RyaW5nIHwgdW5kZWZpbmVkKTtcblxuZnVuY3Rpb24gdXBkYXRlQ3VycmVudCgpIHtcbiAgc2NyZWVuSGFzaC52YWx1ZSA9IGxvY2F0aW9uLmhhc2gubWF0Y2goL3NjcmVlbj0oW14mXSopLyk/LlsxXTtcbiAgY29udGV4dC52YWx1ZSA9IGxvY2F0aW9uLmhhc2gubWF0Y2goL2NvbnRleHQ9KFteJl0qKS8pPy5bMV07XG59XG5cbnVwZGF0ZUN1cnJlbnQoKTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvY2F0aW9uY2hhbmdlJywgdXBkYXRlQ3VycmVudCk7XG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignaGFzaGNoYW5nZScsIHVwZGF0ZUN1cnJlbnQpO1xuXG5jb25zdCBzb3J0ZWQgPSBjb21wdXRlZCgoKSA9PlxuICBzdGF0ZS5hbGwudmFsdWVcbiAgICA/LmZpbHRlcih4ID0+ICF4LmhpZGRlbilcbiAgICAuc29ydCgoYSwgYikgPT4gKGEubmFtZSA9PT0gYi5uYW1lID8gMCA6IGEubmFtZSA8IGIubmFtZSA/IC0xIDogMSkpLFxuKTtcblxuY29uc3QgY3VycmVudCA9IGNvbXB1dGVkKFxuICAoKSA9PiBzb3J0ZWQudmFsdWU/LmZpbmQoeCA9PiB4LmlkID09PSBzY3JlZW5IYXNoLnZhbHVlKSA/PyBzb3J0ZWQudmFsdWU/LlswXSxcbik7XG5cbmV4cG9ydCBjb25zdCBzY3JlZW5zU3RvcmUgPSB7XG4gIC4uLnN0YXRlLFxuICBzb3J0ZWQsXG4gIGN1cnJlbnQsXG59O1xuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFHQSxNQUFBLFFBQUEsa0JBQUE7QUFDQSxNQUFBLFFBQUEsTUFBQTtBQUVBLE1BQUEsVUFBQSxnQkFBQSxFQUFBO0FBRUEsYUFBQTtBQUFBLEVBQWEsUUFBQSxNQUFBO0FBRVQsVUFBQSxPQUFBLEtBQUEsT0FBQTtBQUNBLFlBQUEsU0FBQTtBQUNBLFlBQUEsS0FBQSxHQUFBLEtBQUEsY0FBQTtBQUNBLFVBQUEsV0FBQTtBQUFBLEVBQWlCO0FBQUEsRUFDbkIsZUFBQSxNQUFBO0FBRUUsVUFBQSxPQUFBLElBQUE7QUFBQSxFQUFpQjtBQUFBLEVBQ25CLGtCQUFBLE1BQUE7QUFFRSxVQUFBLFNBQUEsTUFBQSxRQUFBLEtBQUEsRUFBQTtBQUNBLFFBQUEsV0FBQSxRQUFBO0FBQ0UsWUFBQSxPQUFBO0FBQUEsUUFBYSxHQUFBO0FBQUEsUUFDUixNQUFBLEtBQUE7QUFBQSxNQUNRLENBQUE7QUFBQSxJQUNaO0FBQUEsRUFDSDtBQUFBLEVBQ0Ysa0JBQUEsTUFBQTtBQUVFLFVBQUEsU0FBQSxNQUFBLFFBQUEsS0FBQSxFQUFBO0FBQ0EsUUFBQSxDQUFBLFFBQUE7QUFDRTtBQUFBLElBQUE7QUFFRixVQUFBLFVBQUEsS0FBQSxFQUFBO0FBQ0EsWUFBQSxRQUFBLE1BQUE7QUFBQSxFQUFzQjtBQUFBLEVBQ3hCLHNCQUFBO0FBRUUsVUFBQSxTQUFBLFFBQUEsTUFBQTtBQUNBLFFBQUEsQ0FBQSxRQUFBO0FBQ0U7QUFBQSxJQUFBO0FBRUYsVUFBQSxPQUFBLE1BQUE7QUFBQSxFQUFtQjtBQUV2QixDQUFBO0FBRU8sTUFBQSxhQUFBLElBQUEsTUFBQTtBQUNBLE1BQUEsVUFBQSxJQUFBLE1BQUE7QUFFUCxTQUFBLGdCQUFBO0FBQ0UsYUFBQSxRQUFBLFNBQUEsS0FBQSxNQUFBLGdCQUFBLElBQUEsQ0FBQTtBQUNBLFVBQUEsUUFBQSxTQUFBLEtBQUEsTUFBQSxpQkFBQSxJQUFBLENBQUE7QUFDRjtBQUVBLGNBQUE7QUFFQSxPQUFBLGlCQUFBLGtCQUFBLGFBQUE7QUFDQSxPQUFBLGlCQUFBLGNBQUEsYUFBQTtBQUVBLE1BQUEsU0FBQTtBQUFBLEVBQWUsTUFBQSxNQUFBLElBQUEsT0FBQSxPQUFBLENBQUEsTUFBQSxDQUFBLEVBQUEsTUFBQSxFQUFBLEtBQUEsQ0FBQSxHQUFBLE1BQUEsRUFBQSxTQUFBLEVBQUEsT0FBQSxJQUFBLEVBQUEsT0FBQSxFQUFBLE9BQUEsS0FBQSxDQUFBO0FBSWY7QUFFQSxNQUFBLFVBQUE7QUFBQSxFQUFnQixNQUFBLE9BQUEsT0FBQSxLQUFBLENBQUEsTUFBQSxFQUFBLE9BQUEsV0FBQSxLQUFBLEtBQUEsT0FBQSxRQUFBLENBQUE7QUFFaEI7QUFFTyxNQUFBLGVBQUE7QUFBQSxFQUFxQixHQUFBO0FBQUEsRUFDdkI7QUFBQSxFQUNIO0FBRUY7In0=
