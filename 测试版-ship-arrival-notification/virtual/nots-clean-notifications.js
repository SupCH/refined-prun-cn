import { subscribe } from './subscribe-async-generator.js';
import { $$, _$$ } from './select-dom.js';
import { C } from './prun-css.js';
import tiles from './tiles.js';
import features from './feature-registry.js';
import { getPrunId } from './attributes.js';
import { alertsStore } from './alerts.js';
import { waitNotificationLoaded } from './notifications.js';
function onTileReady(tile) {
  subscribe($$(tile.anchor, C.AlertListItem.container), processNotification);
}
async function processNotification(container) {
  const content = await waitNotificationLoaded(container);
  const id = getPrunId(container);
  const alert = alertsStore.getById(id);
  if (!alert) {
    return;
  }
  const patch = patchMap.get(alert.type);
  if (!patch) {
    return;
  }
  const textSpan = _$$(content, 'span')[0];
  if (!textSpan?.textContent) {
    return;
  }
  for (const node of Array.from(textSpan.childNodes)) {
    if (node.nodeType !== Node.TEXT_NODE) {
      continue;
    }
    const nodeText = node.textContent;
    if (!nodeText) {
      continue;
    }
    const newText = patch.replace(nodeText);
    if (nodeText !== newText) {
      node.textContent = newText;
    }
  }
}
const patches = [
  {
    types: [
      'CONTRACT_CONDITION_FULFILLED',
      'CONTRACT_CONTRACT_BREACHED',
      'CONTRACT_CONTRACT_CANCELLED',
      'CONTRACT_CONTRACT_CLOSED',
      'CONTRACT_CONTRACT_EXTENDED',
      'CONTRACT_CONTRACT_RECEIVED',
      'CONTRACT_CONTRACT_REJECTED',
      'CONTRACT_CONTRACT_TERMINATED',
      'CONTRACT_CONTRACT_TERMINATION_REQUESTED',
      'CONTRACT_DEADLINE_EXCEEDED_WITH_CONTROL',
      'CONTRACT_DEADLINE_EXCEEDED_WITHOUT_CONTROL',
    ],
    replace(text) {
      return text.replace('fulfilled a contract condition for contract', 'fulfilled on');
    },
  },
  {
    types: ['COMEX_ORDER_FILLED', 'FOREX_ORDER_FILLED'],
    replace(text) {
      return text.replace(' Commodity Exchange', '').replace(' order', '');
    },
  },
  {
    types: ['COMEX_TRADE', 'FOREX_TRADE'],
    replace(text) {
      return text.replace(' Commodity Exchange', '').replace(' your', '').replace(' order', '');
    },
  },
  {
    types: ['PRODUCTION_ORDER_FINISHED'],
    replace(text) {
      return text
        .replace(' at your base', '')
        .replace('One', '1')
        .replace(' have been', '')
        .replace(/ units? of/, '')
        .replace(' produced', '');
    },
  },
  {
    types: ['COGC_PROGRAM_CHANGED', 'COGC_STATUS_CHANGED', 'COGC_UPKEEP_STARTED'],
    replace(text) {
      return text
        .replace('Chamber of Global Commerce', 'COGC')
        .replace(' a new economic program', '')
        .replace(' Advertising Campaign:', '');
    },
  },
  {
    types: ['SHIP_FLIGHT_ENDED'],
    replace(text) {
      return text.replace(' its destination', '');
    },
  },
  {
    types: ['LOCAL_MARKET_AD_ACCEPTED', 'LOCAL_MARKET_AD_EXPIRED'],
    replace(text) {
      return text.replace(' the', '').replace(' local market', '');
    },
  },
  {
    types: ['POPULATION_PROJECT_UPGRADED'],
    replace(text) {
      return text.replace('population infrastructure', 'POPI');
    },
  },
];
const patchMap = new Map(patches.flatMap(x => x.types.map(y => [y, x])));
function init() {
  tiles.observe('NOTS', onTileReady);
}
features.add(import.meta.url, init, 'NOTS: Hides redundant information from notifications.');
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90cy1jbGVhbi1ub3RpZmljYXRpb25zLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZmVhdHVyZXMvYWR2YW5jZWQvbm90cy1jbGVhbi1ub3RpZmljYXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldFBydW5JZCB9IGZyb20gJ0BzcmMvaW5mcmFzdHJ1Y3R1cmUvcHJ1bi11aS9hdHRyaWJ1dGVzJztcbmltcG9ydCB7IGFsZXJ0c1N0b3JlIH0gZnJvbSAnQHNyYy9pbmZyYXN0cnVjdHVyZS9wcnVuLWFwaS9kYXRhL2FsZXJ0cyc7XG5pbXBvcnQgeyB3YWl0Tm90aWZpY2F0aW9uTG9hZGVkIH0gZnJvbSAnQHNyYy9pbmZyYXN0cnVjdHVyZS9wcnVuLXVpL25vdGlmaWNhdGlvbnMnO1xuXG5mdW5jdGlvbiBvblRpbGVSZWFkeSh0aWxlOiBQcnVuVGlsZSkge1xuICBzdWJzY3JpYmUoJCQodGlsZS5hbmNob3IsIEMuQWxlcnRMaXN0SXRlbS5jb250YWluZXIpLCBwcm9jZXNzTm90aWZpY2F0aW9uKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc05vdGlmaWNhdGlvbihjb250YWluZXI6IEhUTUxFbGVtZW50KSB7XG4gIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB3YWl0Tm90aWZpY2F0aW9uTG9hZGVkKGNvbnRhaW5lcik7XG5cbiAgY29uc3QgaWQgPSBnZXRQcnVuSWQoY29udGFpbmVyKTtcbiAgY29uc3QgYWxlcnQgPSBhbGVydHNTdG9yZS5nZXRCeUlkKGlkKTtcbiAgaWYgKCFhbGVydCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHBhdGNoID0gcGF0Y2hNYXAuZ2V0KGFsZXJ0LnR5cGUpO1xuICBpZiAoIXBhdGNoKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgdGV4dFNwYW4gPSBfJCQoY29udGVudCwgJ3NwYW4nKVswXTtcbiAgaWYgKCF0ZXh0U3Bhbj8udGV4dENvbnRlbnQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBXZSBuZWVkIHRvIHJlcGxhY2UgdGhlIHRleHQgY29udGVudCBWRVJZIGNhcmVmdWxseSxcbiAgLy8gc2luY2UgaXQncyBhbGwgdGV4dCBub2RlcyB3aGljaCBjYW4gYmUgdXBkYXRlZCBieSBSZWFjdCBhdCBhbnkgdGltZS5cbiAgZm9yIChjb25zdCBub2RlIG9mIEFycmF5LmZyb20odGV4dFNwYW4uY2hpbGROb2RlcykpIHtcbiAgICBpZiAobm9kZS5ub2RlVHlwZSAhPT0gTm9kZS5URVhUX05PREUpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBjb25zdCBub2RlVGV4dCA9IG5vZGUudGV4dENvbnRlbnQ7XG4gICAgaWYgKCFub2RlVGV4dCkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGNvbnN0IG5ld1RleHQgPSBwYXRjaC5yZXBsYWNlKG5vZGVUZXh0KTtcbiAgICBpZiAobm9kZVRleHQgIT09IG5ld1RleHQpIHtcbiAgICAgIG5vZGUudGV4dENvbnRlbnQgPSBuZXdUZXh0O1xuICAgIH1cbiAgfVxufVxuXG5pbnRlcmZhY2UgQWxlcnRQYXRjaCB7XG4gIHR5cGVzOiBQcnVuQXBpLkFsZXJ0VHlwZVtdO1xuXG4gIHJlcGxhY2UodGV4dDogc3RyaW5nKTogc3RyaW5nO1xufVxuXG5jb25zdCBwYXRjaGVzOiBBbGVydFBhdGNoW10gPSBbXG4gIHtcbiAgICB0eXBlczogW1xuICAgICAgJ0NPTlRSQUNUX0NPTkRJVElPTl9GVUxGSUxMRUQnLFxuICAgICAgJ0NPTlRSQUNUX0NPTlRSQUNUX0JSRUFDSEVEJyxcbiAgICAgICdDT05UUkFDVF9DT05UUkFDVF9DQU5DRUxMRUQnLFxuICAgICAgJ0NPTlRSQUNUX0NPTlRSQUNUX0NMT1NFRCcsXG4gICAgICAnQ09OVFJBQ1RfQ09OVFJBQ1RfRVhURU5ERUQnLFxuICAgICAgJ0NPTlRSQUNUX0NPTlRSQUNUX1JFQ0VJVkVEJyxcbiAgICAgICdDT05UUkFDVF9DT05UUkFDVF9SRUpFQ1RFRCcsXG4gICAgICAnQ09OVFJBQ1RfQ09OVFJBQ1RfVEVSTUlOQVRFRCcsXG4gICAgICAnQ09OVFJBQ1RfQ09OVFJBQ1RfVEVSTUlOQVRJT05fUkVRVUVTVEVEJyxcbiAgICAgICdDT05UUkFDVF9ERUFETElORV9FWENFRURFRF9XSVRIX0NPTlRST0wnLFxuICAgICAgJ0NPTlRSQUNUX0RFQURMSU5FX0VYQ0VFREVEX1dJVEhPVVRfQ09OVFJPTCcsXG4gICAgXSxcbiAgICByZXBsYWNlKHRleHQ6IHN0cmluZykge1xuICAgICAgcmV0dXJuIHRleHQucmVwbGFjZSgnZnVsZmlsbGVkIGEgY29udHJhY3QgY29uZGl0aW9uIGZvciBjb250cmFjdCcsICdmdWxmaWxsZWQgb24nKTtcbiAgICB9LFxuICB9LFxuICB7XG4gICAgdHlwZXM6IFsnQ09NRVhfT1JERVJfRklMTEVEJywgJ0ZPUkVYX09SREVSX0ZJTExFRCddLFxuICAgIHJlcGxhY2UodGV4dDogc3RyaW5nKSB7XG4gICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKCcgQ29tbW9kaXR5IEV4Y2hhbmdlJywgJycpLnJlcGxhY2UoJyBvcmRlcicsICcnKTtcbiAgICB9LFxuICB9LFxuICB7XG4gICAgdHlwZXM6IFsnQ09NRVhfVFJBREUnLCAnRk9SRVhfVFJBREUnXSxcbiAgICByZXBsYWNlKHRleHQ6IHN0cmluZykge1xuICAgICAgcmV0dXJuIHRleHQucmVwbGFjZSgnIENvbW1vZGl0eSBFeGNoYW5nZScsICcnKS5yZXBsYWNlKCcgeW91cicsICcnKS5yZXBsYWNlKCcgb3JkZXInLCAnJyk7XG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHR5cGVzOiBbJ1BST0RVQ1RJT05fT1JERVJfRklOSVNIRUQnXSxcbiAgICByZXBsYWNlKHRleHQ6IHN0cmluZykge1xuICAgICAgcmV0dXJuIHRleHRcbiAgICAgICAgLnJlcGxhY2UoJyBhdCB5b3VyIGJhc2UnLCAnJylcbiAgICAgICAgLnJlcGxhY2UoJ09uZScsICcxJylcbiAgICAgICAgLnJlcGxhY2UoJyBoYXZlIGJlZW4nLCAnJylcbiAgICAgICAgLnJlcGxhY2UoLyB1bml0cz8gb2YvLCAnJylcbiAgICAgICAgLnJlcGxhY2UoJyBwcm9kdWNlZCcsICcnKTtcbiAgICB9LFxuICB9LFxuICB7XG4gICAgdHlwZXM6IFsnQ09HQ19QUk9HUkFNX0NIQU5HRUQnLCAnQ09HQ19TVEFUVVNfQ0hBTkdFRCcsICdDT0dDX1VQS0VFUF9TVEFSVEVEJ10sXG4gICAgcmVwbGFjZSh0ZXh0OiBzdHJpbmcpIHtcbiAgICAgIHJldHVybiB0ZXh0XG4gICAgICAgIC5yZXBsYWNlKCdDaGFtYmVyIG9mIEdsb2JhbCBDb21tZXJjZScsICdDT0dDJylcbiAgICAgICAgLnJlcGxhY2UoJyBhIG5ldyBlY29ub21pYyBwcm9ncmFtJywgJycpXG4gICAgICAgIC5yZXBsYWNlKCcgQWR2ZXJ0aXNpbmcgQ2FtcGFpZ246JywgJycpO1xuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB0eXBlczogWydTSElQX0ZMSUdIVF9FTkRFRCddLFxuICAgIHJlcGxhY2UodGV4dDogc3RyaW5nKSB7XG4gICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKCcgaXRzIGRlc3RpbmF0aW9uJywgJycpO1xuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB0eXBlczogWydMT0NBTF9NQVJLRVRfQURfQUNDRVBURUQnLCAnTE9DQUxfTUFSS0VUX0FEX0VYUElSRUQnXSxcbiAgICByZXBsYWNlKHRleHQ6IHN0cmluZykge1xuICAgICAgcmV0dXJuIHRleHQucmVwbGFjZSgnIHRoZScsICcnKS5yZXBsYWNlKCcgbG9jYWwgbWFya2V0JywgJycpO1xuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB0eXBlczogWydQT1BVTEFUSU9OX1BST0pFQ1RfVVBHUkFERUQnXSxcbiAgICByZXBsYWNlKHRleHQ6IHN0cmluZykge1xuICAgICAgcmV0dXJuIHRleHQucmVwbGFjZSgncG9wdWxhdGlvbiBpbmZyYXN0cnVjdHVyZScsICdQT1BJJyk7XG4gICAgfSxcbiAgfSxcbl07XG5cbmNvbnN0IHBhdGNoTWFwID0gbmV3IE1hcChwYXRjaGVzLmZsYXRNYXAoeCA9PiB4LnR5cGVzLm1hcCh5ID0+IFt5LCB4XSkpKTtcblxuZnVuY3Rpb24gaW5pdCgpIHtcbiAgdGlsZXMub2JzZXJ2ZSgnTk9UUycsIG9uVGlsZVJlYWR5KTtcbn1cblxuZmVhdHVyZXMuYWRkKGltcG9ydC5tZXRhLnVybCwgaW5pdCwgJ05PVFM6IEhpZGVzIHJlZHVuZGFudCBpbmZvcm1hdGlvbiBmcm9tIG5vdGlmaWNhdGlvbnMuJyk7XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFJQSxTQUFBLFlBQUEsTUFBQTtBQUNFLFlBQUEsR0FBQSxLQUFBLFFBQUEsRUFBQSxjQUFBLFNBQUEsR0FBQSxtQkFBQTtBQUNGO0FBRUEsZUFBQSxvQkFBQSxXQUFBO0FBQ0UsUUFBQSxVQUFBLE1BQUEsdUJBQUEsU0FBQTtBQUVBLFFBQUEsS0FBQSxVQUFBLFNBQUE7QUFDQSxRQUFBLFFBQUEsWUFBQSxRQUFBLEVBQUE7QUFDQSxNQUFBLENBQUEsT0FBQTtBQUNFO0FBQUEsRUFBQTtBQUdGLFFBQUEsUUFBQSxTQUFBLElBQUEsTUFBQSxJQUFBO0FBQ0EsTUFBQSxDQUFBLE9BQUE7QUFDRTtBQUFBLEVBQUE7QUFHRixRQUFBLFdBQUEsSUFBQSxTQUFBLE1BQUEsRUFBQSxDQUFBO0FBQ0EsTUFBQSxDQUFBLFVBQUEsYUFBQTtBQUNFO0FBQUEsRUFBQTtBQUtGLGFBQUEsUUFBQSxNQUFBLEtBQUEsU0FBQSxVQUFBLEdBQUE7QUFDRSxRQUFBLEtBQUEsYUFBQSxLQUFBLFdBQUE7QUFDRTtBQUFBLElBQUE7QUFFRixVQUFBLFdBQUEsS0FBQTtBQUNBLFFBQUEsQ0FBQSxVQUFBO0FBQ0U7QUFBQSxJQUFBO0FBRUYsVUFBQSxVQUFBLE1BQUEsUUFBQSxRQUFBO0FBQ0EsUUFBQSxhQUFBLFNBQUE7QUFDRSxXQUFBLGNBQUE7QUFBQSxJQUFtQjtBQUFBLEVBQ3JCO0FBRUo7QUFRQSxNQUFBLFVBQUE7QUFBQSxFQUE4QjtBQUFBLElBQzVCLE9BQUE7QUFBQSxNQUNTO0FBQUEsTUFDTDtBQUFBLE1BQ0E7QUFBQSxNQUNBO0FBQUEsTUFDQTtBQUFBLE1BQ0E7QUFBQSxNQUNBO0FBQUEsTUFDQTtBQUFBLE1BQ0E7QUFBQSxNQUNBO0FBQUEsTUFDQTtBQUFBLElBQ0E7QUFBQSxJQUNGLFFBQUEsTUFBQTtBQUVFLGFBQUEsS0FBQSxRQUFBLCtDQUFBLGNBQUE7QUFBQSxJQUFpRjtBQUFBLEVBQ25GO0FBQUEsRUFDRjtBQUFBLElBQ0EsT0FBQSxDQUFBLHNCQUFBLG9CQUFBO0FBQUEsSUFDb0QsUUFBQSxNQUFBO0FBRWhELGFBQUEsS0FBQSxRQUFBLHVCQUFBLEVBQUEsRUFBQSxRQUFBLFVBQUEsRUFBQTtBQUFBLElBQW1FO0FBQUEsRUFDckU7QUFBQSxFQUNGO0FBQUEsSUFDQSxPQUFBLENBQUEsZUFBQSxhQUFBO0FBQUEsSUFDc0MsUUFBQSxNQUFBO0FBRWxDLGFBQUEsS0FBQSxRQUFBLHVCQUFBLEVBQUEsRUFBQSxRQUFBLFNBQUEsRUFBQSxFQUFBLFFBQUEsVUFBQSxFQUFBO0FBQUEsSUFBd0Y7QUFBQSxFQUMxRjtBQUFBLEVBQ0Y7QUFBQSxJQUNBLE9BQUEsQ0FBQSwyQkFBQTtBQUFBLElBQ3FDLFFBQUEsTUFBQTtBQUVqQyxhQUFBLEtBQUEsUUFBQSxpQkFBQSxFQUFBLEVBQUEsUUFBQSxPQUFBLEdBQUEsRUFBQSxRQUFBLGNBQUEsRUFBQSxFQUFBLFFBQUEsY0FBQSxFQUFBLEVBQUEsUUFBQSxhQUFBLEVBQUE7QUFBQSxJQUswQjtBQUFBLEVBQzVCO0FBQUEsRUFDRjtBQUFBLElBQ0EsT0FBQSxDQUFBLHdCQUFBLHVCQUFBLHFCQUFBO0FBQUEsSUFDOEUsUUFBQSxNQUFBO0FBRTFFLGFBQUEsS0FBQSxRQUFBLDhCQUFBLE1BQUEsRUFBQSxRQUFBLDJCQUFBLEVBQUEsRUFBQSxRQUFBLDBCQUFBLEVBQUE7QUFBQSxJQUd1QztBQUFBLEVBQ3pDO0FBQUEsRUFDRjtBQUFBLElBQ0EsT0FBQSxDQUFBLG1CQUFBO0FBQUEsSUFDNkIsUUFBQSxNQUFBO0FBRXpCLGFBQUEsS0FBQSxRQUFBLG9CQUFBLEVBQUE7QUFBQSxJQUEwQztBQUFBLEVBQzVDO0FBQUEsRUFDRjtBQUFBLElBQ0EsT0FBQSxDQUFBLDRCQUFBLHlCQUFBO0FBQUEsSUFDK0QsUUFBQSxNQUFBO0FBRTNELGFBQUEsS0FBQSxRQUFBLFFBQUEsRUFBQSxFQUFBLFFBQUEsaUJBQUEsRUFBQTtBQUFBLElBQTJEO0FBQUEsRUFDN0Q7QUFBQSxFQUNGO0FBQUEsSUFDQSxPQUFBLENBQUEsNkJBQUE7QUFBQSxJQUN1QyxRQUFBLE1BQUE7QUFFbkMsYUFBQSxLQUFBLFFBQUEsNkJBQUEsTUFBQTtBQUFBLElBQXVEO0FBQUEsRUFDekQ7QUFFSjtBQUVBLE1BQUEsV0FBQSxJQUFBLElBQUEsUUFBQSxRQUFBLENBQUEsTUFBQSxFQUFBLE1BQUEsSUFBQSxDQUFBLE1BQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQSxDQUFBLENBQUE7QUFFQSxTQUFBLE9BQUE7QUFDRSxRQUFBLFFBQUEsUUFBQSxXQUFBO0FBQ0Y7QUFFQSxTQUFBLElBQUEsWUFBQSxLQUFBLE1BQUEsdURBQUE7In0=
