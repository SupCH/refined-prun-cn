import { createEntityStore } from './create-entity-store.js';
import { onApiMessage } from './api-messages.js';
import { createMapGetter, createGroupMapGetter } from './create-map-getter.js';
import { request } from './request-hooks2.js';
import { reactive, ref } from './reactivity.esm-bundler.js';
const store = createEntityStore();
const state = store.state;
const fetchedSites = reactive(/* @__PURE__ */ new Set());
const fetchedAll = ref(false);
onApiMessage({
  CLIENT_CONNECTION_OPENED() {
    fetchedSites.clear();
    fetchedAll.value = false;
  },
  PRODUCTION_PRODUCTION_LINES(data) {
    store.setAll(data.productionLines);
    fetchedAll.value = true;
    store.setFetched();
  },
  PRODUCTION_SITE_PRODUCTION_LINES(data) {
    store.setMany(data.productionLines);
    fetchedSites.add(data.siteId);
    store.setFetched();
  },
  PRODUCTION_PRODUCTION_LINE(data) {
    store.setOne(data);
    store.setFetched();
  },
  PRODUCTION_PRODUCTION_LINE_ADDED(data) {
    store.addOne(data);
    store.setFetched();
  },
  PRODUCTION_PRODUCTION_LINE_UPDATED(data) {
    store.updateOne(data);
  },
  PRODUCTION_PRODUCTION_LINE_REMOVED(data) {
    store.removeOne(data.productionLineId);
  },
  PRODUCTION_ORDER_ADDED(data) {
    const line = state.getById(data.productionLineId);
    if (line !== void 0 && !line.orders.some(x => x.id === data.id)) {
      store.setOne({
        ...line,
        orders: [...line.orders, data],
      });
    }
  },
  PRODUCTION_ORDER_UPDATED(data) {
    const line = state.getById(data.productionLineId);
    if (line !== void 0) {
      store.setOne({
        ...line,
        orders: line.orders.map(x => (x.id === data.id ? { ...x, ...data } : x)),
      });
    }
  },
  PRODUCTION_ORDER_REMOVED(data) {
    const line = state.getById(data.productionLineId);
    if (line !== void 0) {
      store.setOne({
        ...line,
        orders: line.orders.filter(x => x.id !== data.orderId),
      });
    }
  },
});
const getByShortId = createMapGetter(state.all, x => x.id.substring(0, 8));
const getById = value => state.getById(value) ?? getByShortId(value);
const getByShortSiteId = createGroupMapGetter(state.all, x => x.siteId.substring(0, 8));
const getByFullSiteId = createGroupMapGetter(state.all, x => x.siteId);
const getBySiteId = value => {
  const result = getByFullSiteId(value) ?? getByShortSiteId(value);
  if (result) {
    return result;
  }
  if (!value) {
    return void 0;
  }
  if (fetchedAll.value || fetchedSites.has(value)) {
    return [];
  } else {
    request.production(value);
  }
  return void 0;
};
const productionStore = {
  ...state,
  getById,
  getBySiteId,
};
export { productionStore };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdGlvbi5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2luZnJhc3RydWN0dXJlL3BydW4tYXBpL2RhdGEvcHJvZHVjdGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVFbnRpdHlTdG9yZSB9IGZyb20gJ0BzcmMvaW5mcmFzdHJ1Y3R1cmUvcHJ1bi1hcGkvZGF0YS9jcmVhdGUtZW50aXR5LXN0b3JlJztcbmltcG9ydCB7IG9uQXBpTWVzc2FnZSB9IGZyb20gJ0BzcmMvaW5mcmFzdHJ1Y3R1cmUvcHJ1bi1hcGkvZGF0YS9hcGktbWVzc2FnZXMnO1xuaW1wb3J0IHtcbiAgY3JlYXRlR3JvdXBNYXBHZXR0ZXIsXG4gIGNyZWF0ZU1hcEdldHRlcixcbn0gZnJvbSAnQHNyYy9pbmZyYXN0cnVjdHVyZS9wcnVuLWFwaS9kYXRhL2NyZWF0ZS1tYXAtZ2V0dGVyJztcbmltcG9ydCB7IHJlcXVlc3QgfSBmcm9tICdAc3JjL2luZnJhc3RydWN0dXJlL3BydW4tYXBpL2RhdGEvcmVxdWVzdC1ob29rcyc7XG5cbmNvbnN0IHN0b3JlID0gY3JlYXRlRW50aXR5U3RvcmU8UHJ1bkFwaS5Qcm9kdWN0aW9uTGluZT4oKTtcbmNvbnN0IHN0YXRlID0gc3RvcmUuc3RhdGU7XG5jb25zdCBmZXRjaGVkU2l0ZXMgPSByZWFjdGl2ZShuZXcgU2V0PHN0cmluZz4oKSk7XG5jb25zdCBmZXRjaGVkQWxsID0gcmVmKGZhbHNlKTtcblxub25BcGlNZXNzYWdlKHtcbiAgQ0xJRU5UX0NPTk5FQ1RJT05fT1BFTkVEKCkge1xuICAgIGZldGNoZWRTaXRlcy5jbGVhcigpO1xuICAgIGZldGNoZWRBbGwudmFsdWUgPSBmYWxzZTtcbiAgfSxcbiAgUFJPRFVDVElPTl9QUk9EVUNUSU9OX0xJTkVTKGRhdGE6IHsgcHJvZHVjdGlvbkxpbmVzOiBQcnVuQXBpLlByb2R1Y3Rpb25MaW5lW10gfSkge1xuICAgIHN0b3JlLnNldEFsbChkYXRhLnByb2R1Y3Rpb25MaW5lcyk7XG4gICAgZmV0Y2hlZEFsbC52YWx1ZSA9IHRydWU7XG4gICAgc3RvcmUuc2V0RmV0Y2hlZCgpO1xuICB9LFxuICBQUk9EVUNUSU9OX1NJVEVfUFJPRFVDVElPTl9MSU5FUyhkYXRhOiB7XG4gICAgc2l0ZUlkOiBzdHJpbmc7XG4gICAgcHJvZHVjdGlvbkxpbmVzOiBQcnVuQXBpLlByb2R1Y3Rpb25MaW5lW107XG4gIH0pIHtcbiAgICBzdG9yZS5zZXRNYW55KGRhdGEucHJvZHVjdGlvbkxpbmVzKTtcbiAgICBmZXRjaGVkU2l0ZXMuYWRkKGRhdGEuc2l0ZUlkKTtcbiAgICBzdG9yZS5zZXRGZXRjaGVkKCk7XG4gIH0sXG4gIFBST0RVQ1RJT05fUFJPRFVDVElPTl9MSU5FKGRhdGE6IFBydW5BcGkuUHJvZHVjdGlvbkxpbmUpIHtcbiAgICBzdG9yZS5zZXRPbmUoZGF0YSk7XG4gICAgc3RvcmUuc2V0RmV0Y2hlZCgpO1xuICB9LFxuICBQUk9EVUNUSU9OX1BST0RVQ1RJT05fTElORV9BRERFRChkYXRhOiBQcnVuQXBpLlByb2R1Y3Rpb25MaW5lKSB7XG4gICAgc3RvcmUuYWRkT25lKGRhdGEpO1xuICAgIHN0b3JlLnNldEZldGNoZWQoKTtcbiAgfSxcbiAgUFJPRFVDVElPTl9QUk9EVUNUSU9OX0xJTkVfVVBEQVRFRChkYXRhOiBQcnVuQXBpLlByb2R1Y3Rpb25MaW5lKSB7XG4gICAgc3RvcmUudXBkYXRlT25lKGRhdGEpO1xuICB9LFxuICBQUk9EVUNUSU9OX1BST0RVQ1RJT05fTElORV9SRU1PVkVEKGRhdGE6IHsgcHJvZHVjdGlvbkxpbmVJZDogc3RyaW5nIH0pIHtcbiAgICBzdG9yZS5yZW1vdmVPbmUoZGF0YS5wcm9kdWN0aW9uTGluZUlkKTtcbiAgfSxcbiAgUFJPRFVDVElPTl9PUkRFUl9BRERFRChkYXRhOiBQcnVuQXBpLlByb2R1Y3Rpb25PcmRlcikge1xuICAgIGNvbnN0IGxpbmUgPSBzdGF0ZS5nZXRCeUlkKGRhdGEucHJvZHVjdGlvbkxpbmVJZCk7XG4gICAgaWYgKGxpbmUgIT09IHVuZGVmaW5lZCAmJiAhbGluZS5vcmRlcnMuc29tZSh4ID0+IHguaWQgPT09IGRhdGEuaWQpKSB7XG4gICAgICBzdG9yZS5zZXRPbmUoe1xuICAgICAgICAuLi5saW5lLFxuICAgICAgICBvcmRlcnM6IFsuLi5saW5lLm9yZGVycywgZGF0YV0sXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gIFBST0RVQ1RJT05fT1JERVJfVVBEQVRFRChkYXRhOiBQcnVuQXBpLlByb2R1Y3Rpb25PcmRlcikge1xuICAgIGNvbnN0IGxpbmUgPSBzdGF0ZS5nZXRCeUlkKGRhdGEucHJvZHVjdGlvbkxpbmVJZCk7XG4gICAgaWYgKGxpbmUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgc3RvcmUuc2V0T25lKHtcbiAgICAgICAgLi4ubGluZSxcbiAgICAgICAgb3JkZXJzOiBsaW5lLm9yZGVycy5tYXAoeCA9PiAoeC5pZCA9PT0gZGF0YS5pZCA/IHsgLi4ueCwgLi4uZGF0YSB9IDogeCkpLFxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuICBQUk9EVUNUSU9OX09SREVSX1JFTU9WRUQoZGF0YTogeyBvcmRlcklkOiBzdHJpbmc7IHByb2R1Y3Rpb25MaW5lSWQ6IHN0cmluZyB9KSB7XG4gICAgY29uc3QgbGluZSA9IHN0YXRlLmdldEJ5SWQoZGF0YS5wcm9kdWN0aW9uTGluZUlkKTtcbiAgICBpZiAobGluZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBzdG9yZS5zZXRPbmUoe1xuICAgICAgICAuLi5saW5lLFxuICAgICAgICBvcmRlcnM6IGxpbmUub3JkZXJzLmZpbHRlcih4ID0+IHguaWQgIT09IGRhdGEub3JkZXJJZCksXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG59KTtcblxuY29uc3QgZ2V0QnlTaG9ydElkID0gY3JlYXRlTWFwR2V0dGVyKHN0YXRlLmFsbCwgeCA9PiB4LmlkLnN1YnN0cmluZygwLCA4KSk7XG5cbmNvbnN0IGdldEJ5SWQgPSAodmFsdWU/OiBzdHJpbmcgfCBudWxsKSA9PiBzdGF0ZS5nZXRCeUlkKHZhbHVlKSA/PyBnZXRCeVNob3J0SWQodmFsdWUpO1xuXG5jb25zdCBnZXRCeVNob3J0U2l0ZUlkID0gY3JlYXRlR3JvdXBNYXBHZXR0ZXIoc3RhdGUuYWxsLCB4ID0+IHguc2l0ZUlkLnN1YnN0cmluZygwLCA4KSk7XG5cbmNvbnN0IGdldEJ5RnVsbFNpdGVJZCA9IGNyZWF0ZUdyb3VwTWFwR2V0dGVyKHN0YXRlLmFsbCwgeCA9PiB4LnNpdGVJZCk7XG5cbmNvbnN0IGdldEJ5U2l0ZUlkID0gKHZhbHVlPzogc3RyaW5nIHwgbnVsbCkgPT4ge1xuICBjb25zdCByZXN1bHQgPSBnZXRCeUZ1bGxTaXRlSWQodmFsdWUpID8/IGdldEJ5U2hvcnRTaXRlSWQodmFsdWUpO1xuICBpZiAocmVzdWx0KSB7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGlmICghdmFsdWUpIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgaWYgKGZldGNoZWRBbGwudmFsdWUgfHwgZmV0Y2hlZFNpdGVzLmhhcyh2YWx1ZSkpIHtcbiAgICByZXR1cm4gW107XG4gIH0gZWxzZSB7XG4gICAgcmVxdWVzdC5wcm9kdWN0aW9uKHZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiB1bmRlZmluZWQ7XG59O1xuXG5leHBvcnQgY29uc3QgcHJvZHVjdGlvblN0b3JlID0ge1xuICAuLi5zdGF0ZSxcbiAgZ2V0QnlJZCxcbiAgZ2V0QnlTaXRlSWQsXG59O1xuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBUUEsTUFBQSxRQUFBLGtCQUFBO0FBQ0EsTUFBQSxRQUFBLE1BQUE7QUFDQSxNQUFBLGVBQUEsU0FBQSxvQkFBQSxLQUFBO0FBQ0EsTUFBQSxhQUFBLElBQUEsS0FBQTtBQUVBLGFBQUE7QUFBQSxFQUFhLDJCQUFBO0FBRVQsaUJBQUEsTUFBQTtBQUNBLGVBQUEsUUFBQTtBQUFBLEVBQW1CO0FBQUEsRUFDckIsNEJBQUEsTUFBQTtBQUVFLFVBQUEsT0FBQSxLQUFBLGVBQUE7QUFDQSxlQUFBLFFBQUE7QUFD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
