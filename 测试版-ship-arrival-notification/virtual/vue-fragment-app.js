import { createApp } from './runtime-dom.esm-bundler.js';
import onNodeDisconnected from './on-node-disconnected.js';
import { h } from './runtime-core.esm-bundler.js';
let scope = void 0;
class FragmentApp {
  fragment;
  app;
  constructor(rootComponent, rootProps) {
    this.fragment = document.createDocumentFragment();
    this.app = createApp({ render: () => h(rootComponent, rootProps) });
    this.addToScope(scope);
  }
  use(plugin, ...options) {
    this.app.use(plugin, ...options);
    return this;
  }
  provide(key, value) {
    this.app.provide(key, value);
    return this;
  }
  mount() {
    return this.app.mount(this.fragment);
  }
  unmount() {
    this.app.unmount();
  }
  appendTo(parent) {
    const instance = this.mount();
    onNodeDisconnected(parent, () => this.app.unmount());
    parent.appendChild(this.fragment);
    return instance;
  }
  prependTo(parent) {
    const instance = this.mount();
    onNodeDisconnected(parent, () => this.app.unmount());
    parent.insertBefore(this.fragment, parent.firstChild);
    return instance;
  }
  before(sibling) {
    const instance = this.mount();
    onNodeDisconnected(sibling.parentElement, () => this.app.unmount());
    sibling.parentElement.insertBefore(this.fragment, sibling);
    return instance;
  }
  after(sibling) {
    const instance = this.mount();
    onNodeDisconnected(sibling.parentElement, () => this.app.unmount());
    sibling.parentElement.insertBefore(this.fragment, sibling.nextSibling);
    return instance;
  }
  addToScope(scope2) {
    scope2?.add(this);
    return this;
  }
}
class FragmentAppScope {
  apps = /* @__PURE__ */ new Set();
  add(app) {
    this.apps.add(app);
  }
  begin() {
    this.unmount();
    scope = this;
  }
  end() {
    scope = void 0;
  }
  unmount() {
    for (const app of this.apps) {
      app.unmount();
    }
    this.apps.clear();
  }
}
function createFragmentApp(rootComponent, rootProps) {
  return new FragmentApp(rootComponent, rootProps);
}
export { FragmentApp, FragmentAppScope, createFragmentApp };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidnVlLWZyYWdtZW50LWFwcC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3V0aWxzL3Z1ZS1mcmFnbWVudC1hcHAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwLCBQbHVnaW4gfSBmcm9tICd2dWUnO1xuaW1wb3J0IG9uTm9kZURpc2Nvbm5lY3RlZCBmcm9tICdAc3JjL3V0aWxzL29uLW5vZGUtZGlzY29ubmVjdGVkJztcblxuZXhwb3J0IHR5cGUgRnJhZ21lbnRBcHBEYXRhID0gUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG5cbmxldCBzY29wZTogRnJhZ21lbnRBcHBTY29wZSB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcblxuZXhwb3J0IGNsYXNzIEZyYWdtZW50QXBwIHtcbiAgZnJhZ21lbnQ6IERvY3VtZW50RnJhZ21lbnQ7XG4gIGFwcDogQXBwO1xuXG4gIGNvbnN0cnVjdG9yKHJvb3RDb21wb25lbnQ6IENvbXBvbmVudCwgcm9vdFByb3BzPzogRnJhZ21lbnRBcHBEYXRhIHwgbnVsbCkge1xuICAgIHRoaXMuZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgdGhpcy5hcHAgPSBjcmVhdGVBcHAoeyByZW5kZXI6ICgpID0+IGgocm9vdENvbXBvbmVudCwgcm9vdFByb3BzKSB9KTtcbiAgICB0aGlzLmFkZFRvU2NvcGUoc2NvcGUpO1xuICB9XG5cbiAgdXNlPE9wdGlvbnMgZXh0ZW5kcyB1bmtub3duW10+KHBsdWdpbjogUGx1Z2luPE9wdGlvbnM+LCAuLi5vcHRpb25zOiBPcHRpb25zKSB7XG4gICAgdGhpcy5hcHAudXNlKHBsdWdpbiwgLi4ub3B0aW9ucyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBwcm92aWRlPFQsIEsgPSBJbmplY3Rpb25LZXk8VD4gfCBzdHJpbmcgfCBudW1iZXI+KFxuICAgIGtleTogSyxcbiAgICB2YWx1ZTogSyBleHRlbmRzIEluamVjdGlvbktleTxpbmZlciBWPiA/IFYgOiBULFxuICApIHtcbiAgICB0aGlzLmFwcC5wcm92aWRlKGtleSwgdmFsdWUpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgbW91bnQoKSB7XG4gICAgcmV0dXJuIHRoaXMuYXBwLm1vdW50KHRoaXMuZnJhZ21lbnQgYXMgdW5rbm93biBhcyBFbGVtZW50KTtcbiAgfVxuXG4gIHVubW91bnQoKSB7XG4gICAgdGhpcy5hcHAudW5tb3VudCgpO1xuICB9XG5cbiAgYXBwZW5kVG8ocGFyZW50OiBOb2RlKSB7XG4gICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLm1vdW50KCk7XG4gICAgb25Ob2RlRGlzY29ubmVjdGVkKHBhcmVudCwgKCkgPT4gdGhpcy5hcHAudW5tb3VudCgpKTtcbiAgICBwYXJlbnQuYXBwZW5kQ2hpbGQodGhpcy5mcmFnbWVudCk7XG4gICAgcmV0dXJuIGluc3RhbmNlO1xuICB9XG5cbiAgcHJlcGVuZFRvKHBhcmVudDogTm9kZSkge1xuICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5tb3VudCgpO1xuICAgIG9uTm9kZURpc2Nvbm5lY3RlZChwYXJlbnQsICgpID0+IHRoaXMuYXBwLnVubW91bnQoKSk7XG4gICAgcGFyZW50Lmluc2VydEJlZm9yZSh0aGlzLmZyYWdtZW50LCBwYXJlbnQuZmlyc3RDaGlsZCk7XG4gICAgcmV0dXJuIGluc3RhbmNlO1xuICB9XG5cbiAgYmVmb3JlKHNpYmxpbmc6IE5vZGUpIHtcbiAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMubW91bnQoKTtcbiAgICBvbk5vZGVEaXNjb25uZWN0ZWQoc2libGluZy5wYXJlbnRFbGVtZW50ISwgKCkgPT4gdGhpcy5hcHAudW5tb3VudCgpKTtcbiAgICBzaWJsaW5nLnBhcmVudEVsZW1lbnQhLmluc2VydEJlZm9yZSh0aGlzLmZyYWdtZW50LCBzaWJsaW5nKTtcbiAgICByZXR1cm4gaW5zdGFuY2U7XG4gIH1cblxuICBhZnRlcihzaWJsaW5nOiBOb2RlKSB7XG4gICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLm1vdW50KCk7XG4gICAgb25Ob2RlRGlzY29ubmVjdGVkKHNpYmxpbmcucGFyZW50RWxlbWVudCEsICgpID0+IHRoaXMuYXBwLnVubW91bnQoKSk7XG4gICAgc2libGluZy5wYXJlbnRFbGVtZW50IS5pbnNlcnRCZWZvcmUodGhpcy5mcmFnbWVudCwgc2libGluZy5uZXh0U2libGluZyk7XG4gICAgcmV0dXJuIGluc3RhbmNlO1xuICB9XG5cbiAgYWRkVG9TY29wZShzY29wZTogRnJhZ21lbnRBcHBTY29wZSB8IHVuZGVmaW5lZCkge1xuICAgIHNjb3BlPy5hZGQodGhpcyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEZyYWdtZW50QXBwU2NvcGUge1xuICBhcHBzID0gbmV3IFNldDxGcmFnbWVudEFwcD4oKTtcblxuICBhZGQoYXBwOiBGcmFnbWVudEFwcCkge1xuICAgIHRoaXMuYXBwcy5hZGQoYXBwKTtcbiAgfVxuXG4gIGJlZ2luKCkge1xuICAgIHRoaXMudW5tb3VudCgpO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdGhpcy1hbGlhc1xuICAgIHNjb3BlID0gdGhpcztcbiAgfVxuXG4gIGVuZCgpIHtcbiAgICBzY29wZSA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHVubW91bnQoKSB7XG4gICAgZm9yIChjb25zdCBhcHAgb2YgdGhpcy5hcHBzKSB7XG4gICAgICBhcHAudW5tb3VudCgpO1xuICAgIH1cbiAgICB0aGlzLmFwcHMuY2xlYXIoKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRnJhZ21lbnRBcHA8VCBleHRlbmRzIENvbXBvbmVudD4oXG4gIHJvb3RDb21wb25lbnQ6IFQsXG4gIHJvb3RQcm9wcz86IEV4dHJhY3RDb21wb25lbnRQcm9wczxUPixcbikge1xuICByZXR1cm4gbmV3IEZyYWdtZW50QXBwKHJvb3RDb21wb25lbnQsIHJvb3RQcm9wcyBhcyBGcmFnbWVudEFwcERhdGEpO1xufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUtBLElBQUEsUUFBQTtBQUVPLE1BQUEsWUFBQTtBQUFBLEVBQWtCO0FBQUEsRUFDdkI7QUFBQSxFQUNBLFlBQUEsZUFBQSxXQUFBO0FBR0UsU0FBQSxXQUFBLFNBQUEsdUJBQUE7QUFDQSxTQUFBLE1BQUEsVUFBQSxFQUFBLFFBQUEsTUFBQSxFQUFBLGVBQUEsU0FBQSxHQUFBO0FBQ0EsU0FBQSxXQUFBLEtBQUE7QUFBQSxFQUFxQjtBQUFBLEVBQ3ZCLElBQUEsV0FBQSxTQUFBO0FBR0UsU0FBQSxJQUFBLElBQUEsUUFBQSxHQUFBLE9BQUE7QUFDQSxXQUFBO0FBQUEsRUFBTztBQUFBLEVBQ1QsUUFBQSxLQUFBLE9BQUE7QUFNRSxTQUFBLElBQUEsUUFBQSxLQUFBLEtBQUE7QUFDQSxXQUFBO0FBQUEsRUFBTztBQUFBLEVBQ1QsUUFBQTtBQUdFLFdBQUEsS0FBQSxJQUFBLE1BQUEsS0FBQSxRQUFBO0FBQUEsRUFBeUQ7QUFBQSxFQUMzRCxVQUFBO0FBR0UsU0FBQSxJQUFBLFFBQUE7QUFBQSxFQUFpQjtBQUFBLEVBQ25CLFNBQUEsUUFBQTtBQUdFLFVBQUEsV0FBQSxLQUFBLE1BQUE7QUFDQSx1QkFBQSxRQUFBLE1BQUEsS0FBQSxJQUFBLFFBQUEsQ0FBQTtBQUNBLFdBQUEsWUFBQSxLQUFBLFFBQUE7QUFDQSxXQUFBO0FBQUEsRUFBTztBQUFBLEVBQ1QsVUFBQSxRQUFBO0FBR0UsVUFBQSxXQUFBLEtBQUEsTUFBQTtBQUNBLHVCQUFBLFFBQUEsTUFBQSxLQUFBLElBQUEsUUFBQSxDQUFBO0FBQ0EsV0FBQSxhQUFBLEtBQUEsVUFBQSxPQUFBLFVBQUE7QUFDQSxXQUFBO0FBQUEsRUFBTztBQUFBLEVBQ1QsT0FBQSxTQUFBO0FBR0UsVUFBQSxXQUFBLEtBQUEsTUFBQTtBQUNBLHVCQUFBLFFBQUEsZUFBQSxNQUFBLEtBQUEsSUFBQSxTQUFBO0FBQ0EsWUFBQSxjQUFBLGFBQUEsS0FBQSxVQUFBLE9BQUE7QUFDQSxXQUFBO0FBQUEsRUFBTztBQUFBLEVBQ1QsTUFBQSxTQUFBO0FBR0UsVUFBQSxXQUFBLEtBQUEsTUFBQTtBQUNBLHVCQUFBLFFBQUEsZUFBQSxNQUFBLEtBQUEsSUFBQSxTQUFBO0FBQ0EsWUFBQSxjQUFBLGFBQUEsS0FBQSxVQUFBLFFBQUEsV0FBQTtBQUNBLFdBQUE7QUFBQSxFQUFPO0FBQUEsRUFDVCxXQUFBLFFBQUE7QUFHRSxZQUFBLElBQUEsSUFBQTtBQUNBLFdBQUE7QUFBQSxFQUFPO0FBRVg7QUFFTyxNQUFBLGlCQUFBO0FBQUEsRUFBdUIsT0FBQSxvQkFBQSxJQUFBO0FBQUEsRUFDQSxJQUFBLEtBQUE7QUFHMUIsU0FBQSxLQUFBLElBQUEsR0FBQTtBQUFBLEVBQWlCO0FBQUEsRUFDbkIsUUFBQTtBQUdFLFNBQUEsUUFBQTtBQUVBLFlBQUE7QUFBQSxFQUFRO0FBQUEsRUFDVixNQUFBO0FBR0UsWUFBQTtBQUFBLEVBQVE7QUFBQSxFQUNWLFVBQUE7QUFHRSxlQUFBLE9BQUEsS0FBQSxNQUFBO0FBQ0UsVUFBQSxRQUFBO0FBQUEsSUFBWTtBQUVkLFNBQUEsS0FBQSxNQUFBO0FBQUEsRUFBZ0I7QUFFcEI7QUFFTyxTQUFBLGtCQUFBLGVBQUEsV0FBQTtBQUlMLFNBQUEsSUFBQSxZQUFBLGVBQUEsU0FBQTtBQUNGOyJ9
